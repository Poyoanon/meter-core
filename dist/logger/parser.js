var $u=Object.create;var Ne=Object.defineProperty;var Qu=Object.getOwnPropertyDescriptor;var Ju=Object.getOwnPropertyNames;var Xu=Object.getPrototypeOf,yu=Object.prototype.hasOwnProperty;var em=(t,e,n)=>e in t?Ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var tm=(t,e)=>{for(var n in e)Ne(t,n,{get:e[n],enumerable:!0})},Mr=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ju(e))!yu.call(t,s)&&s!==n&&Ne(t,s,{get:()=>e[s],enumerable:!(o=Qu(e,s))||o.enumerable});return t};var nm=(t,e,n)=>(n=t!=null?$u(Xu(t)):{},Mr(e||!t||!t.__esModule?Ne(n,"default",{value:t,enumerable:!0}):n,t)),om=t=>Mr(Ne({},"__esModule",{value:!0}),t);var $=(t,e,n)=>(em(t,typeof e!="symbol"?e+"":e,n),n),mn=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var g=(t,e,n)=>(mn(t,e,"read from private field"),n?n.call(t):e.get(t)),J=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},ne=(t,e,n,o)=>(mn(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);var he=(t,e,n)=>(mn(t,e,"access private method"),n);var Qm={};tm(Qm,{Parser:()=>Kr});module.exports=om(Qm);var Gu=require("tiny-typed-emitter");var ie=(c=>(c[c.none=0]="none",c[c.slot=1]="slot",c[c.stat=2]="stat",c[c.ability_point=3]="ability_point",c[c.combat_effect=4]="combat_effect",c[c.skill_damage=5]="skill_damage",c[c.skill_critical_ratio=6]="skill_critical_ratio",c[c.skill_critical_damage=7]="skill_critical_damage",c[c.skill_penetration=8]="skill_penetration",c[c.npc_grade_less_damage=9]="npc_grade_less_damage",c[c.npc_grade_less_critical_ratio=10]="npc_grade_less_critical_ratio",c[c.npc_grade_less_critical_damage=11]="npc_grade_less_critical_damage",c[c.npc_grade_less_penetration=12]="npc_grade_less_penetration",c[c.npc_grade_greater_damage=13]="npc_grade_greater_damage",c[c.npc_grade_greater_critical_ratio=14]="npc_grade_greater_critical_ratio",c[c.npc_grade_greater_critical_damage=15]="npc_grade_greater_critical_damage",c[c.npc_grade_greater_penetration=16]="npc_grade_greater_penetration",c[c.npc_species_damage=17]="npc_species_damage",c[c.npc_species_critical_ratio=18]="npc_species_critical_ratio",c[c.npc_species_critical_damage=19]="npc_species_critical_damage",c[c.npc_species_penetration=20]="npc_species_penetration",c[c.npc_attr_damage=21]="npc_attr_damage",c[c.npc_attr_critical_ratio=22]="npc_attr_critical_ratio",c[c.npc_attr_critical_damage=23]="npc_attr_critical_damage",c[c.npc_attr_penetration=24]="npc_attr_penetration",c[c.mana_reduction=25]="mana_reduction",c[c.skill_mana_reduction=26]="skill_mana_reduction",c[c.skill_cooldown_reduction=27]="skill_cooldown_reduction",c[c.ability_feature=28]="ability_feature",c[c.class_option=29]="class_option",c[c.ability_point_passive=30]="ability_point_passive",c[c.instrument=31]="instrument",c[c.skill_feature=32]="skill_feature",c[c.npc_adaptation=33]="npc_adaptation",c[c.skill_group_damage=34]="skill_group_damage",c[c.skill_group_cooldown_reduction=35]="skill_group_cooldown_reduction",c[c.skill_level=36]="skill_level",c[c.skill_feature_level=37]="skill_feature_level",c[c.life_casting_speed=38]="life_casting_speed",c[c.life_casting_tier=39]="life_casting_tier",c[c.life_bonus_type_success=40]="life_bonus_type_success",c[c.life_bonus_type_extra=41]="life_bonus_type_extra",c[c.life_bonus_type_skill_bonus=42]="life_bonus_type_skill_bonus",c[c.life_bonus_type_minigame_perfect=43]="life_bonus_type_minigame_perfect",c[c.life_durability_bonus=44]="life_durability_bonus",c[c.life_mini_game_difficulty=45]="life_mini_game_difficulty",c[c.combat_effect_cooldown_reduction=46]="combat_effect_cooldown_reduction",c[c.skill_damage_addend=47]="skill_damage_addend",c[c.awakening_usable_count_addend=48]="awakening_usable_count_addend",c[c.battle_item_heal=49]="battle_item_heal",c[c.party_heal=50]="party_heal",c[c.party_shield=51]="party_shield",c[c.identity_gauge=52]="identity_gauge",c[c.attack_power_amplify_addend=53]="attack_power_amplify_addend",c[c.attack_power_amplify_multiplier=54]="attack_power_amplify_multiplier",c[c.not_in_party_damage=55]="not_in_party_damage",c[c.skill_effect_group_set_damage=56]="skill_effect_group_set_damage",c))(ie||{});var jt=(b=>(b[b.none=0]="none",b[b.modify_damage=1]="modify_damage",b[b.modify_final_damage=2]="modify_final_damage",b[b.modify_critical_ratio=3]="modify_critical_ratio",b[b.modify_critical_multiplier=4]="modify_critical_multiplier",b[b.modify_penetration=5]="modify_penetration",b[b.modify_penetration_when_critical=6]="modify_penetration_when_critical",b[b.exec_active_effect_when_damage=7]="exec_active_effect_when_damage",b[b.exec_active_effect_when_critical=8]="exec_active_effect_when_critical",b[b.exec_reactive_effect_when_miss=9]="exec_reactive_effect_when_miss",b[b.exec_reactive_effect_when_damage=10]="exec_reactive_effect_when_damage",b[b.exec_reactive_effect_when_critical=11]="exec_reactive_effect_when_critical",b[b.exec_after_effect=12]="exec_after_effect",b[b.exec_after_skill=13]="exec_after_skill",b[b.apply_heal=14]="apply_heal",b[b.modify_reactive_damage=15]="modify_reactive_damage",b[b.modify_damage_shield_multiplier=16]="modify_damage_shield_multiplier",b[b.exec_active_effect_when_kill=17]="exec_active_effect_when_kill",b[b.exec_start_skill=18]="exec_start_skill",b[b.modify_penetration_addend=19]="modify_penetration_addend",b[b.modify_penetration_addend_when_critical=20]="modify_penetration_addend_when_critical",b[b.modify_reactive_critical_multiplier=21]="modify_reactive_critical_multiplier",b[b.modify_damage_when_critical=22]="modify_damage_when_critical",b[b.modify_paralyzation_point=23]="modify_paralyzation_point",b[b.exec_when_counter=24]="exec_when_counter",b[b.exec_when_be_killed=25]="exec_when_be_killed",b))(jt||{});var _n=(h=>(h[h.none=0]="none",h[h.underling=1]="underling",h[h.normal=2]="normal",h[h.elite=3]="elite",h[h.named=4]="named",h[h.seed=5]="seed",h[h.boss=6]="boss",h[h.raid=7]="raid",h[h.lucky=8]="lucky",h[h.epic_raid=9]="epic_raid",h[h.commander=10]="commander",h))(_n||{});var Ot=(n=>(n[n.absolute=0]="absolute",n[n.relative=1]="relative",n))(Ot||{});var Ft=(u=>(u[u.none=0]="none",u[u.enable_notify=1]="enable_notify",u[u.enable_dir_change=2]="enable_dir_change",u[u.change_move_dist=3]="change_move_dist",u[u.change_layer=4]="change_layer",u[u.change_stage_speed=5]="change_stage_speed",u[u.change_stage_collision=6]="change_stage_collision",u[u.change_max_target=7]="change_max_target",u[u.change_area_range=8]="change_area_range",u[u.change_area_angle=9]="change_area_angle",u[u.change_cost=10]="change_cost",u[u.recover_cost=11]="recover_cost",u[u.recover_used_cost=12]="recover_used_cost",u[u.reduce_default_cooldown=13]="reduce_default_cooldown",u[u.reduce_active_cooldown=14]="reduce_active_cooldown",u[u.enable_stage_buff=15]="enable_stage_buff",u[u.add_stage_buff=16]="add_stage_buff",u[u.change_buff_area_range=17]="change_buff_area_range",u[u.change_buff_duration=18]="change_buff_duration",u[u.change_buff_stat=19]="change_buff_stat",u[u.change_buff_stack=20]="change_buff_stack",u[u.change_buff_param=21]="change_buff_param",u[u.change_buff_expired_action=22]="change_buff_expired_action",u[u.change_chain_ratio=23]="change_chain_ratio",u[u.change_abnormal=24]="change_abnormal",u[u.change_abnormal_ratio=25]="change_abnormal_ratio",u[u.change_dam_attr=26]="change_dam_attr",u[u.change_dam_value=27]="change_dam_value",u[u.change_dam_coefficient=28]="change_dam_coefficient",u[u.change_dam_critical=29]="change_dam_critical",u[u.change_dam_critical_rate=30]="change_dam_critical_rate",u[u.change_attack_stage_speed=31]="change_attack_stage_speed",u[u.change_stack_charge_time=32]="change_stack_charge_time",u[u.change_stack_max_count=33]="change_stack_max_count",u[u.change_targeting=34]="change_targeting",u[u.change_min_range=35]="change_min_range",u[u.change_max_range=36]="change_max_range",u[u.change_push_info=37]="change_push_info",u[u.change_parts_attack_attr=38]="change_parts_attack_attr",u[u.change_skill_chain_info=39]="change_skill_chain_info",u[u.change_skill_chain_delay=40]="change_skill_chain_delay",u[u.change_behit_move_info=41]="change_behit_move_info",u[u.add_buff_stat=42]="add_buff_stat",u[u.add_chain_skill_effect=43]="add_chain_skill_effect",u[u.remove_chain_skill_effect=44]="remove_chain_skill_effect",u[u.add_chain_combat_effect=45]="add_chain_combat_effect",u[u.remove_chain_combat_effect=46]="remove_chain_combat_effect",u[u.change_skill_effect_bonus=47]="change_skill_effect_bonus",u[u.change_skill_effect_ai_point=48]="change_skill_effect_ai_point",u[u.change_dam_addend=49]="change_dam_addend",u[u.change_hitted=50]="change_hitted",u[u.change_skill_move_speed=51]="change_skill_move_speed",u[u.add_skill_buff=52]="add_skill_buff",u[u.change_skill_bonus=53]="change_skill_bonus",u[u.change_skill_normal_info=54]="change_skill_normal_info",u[u.change_skill_invisibility=55]="change_skill_invisibility",u[u.change_skill_constraint=56]="change_skill_constraint",u[u.change_skill_book_type=57]="change_skill_book_type",u[u.change_projection_skill_effect_id=58]="change_projection_skill_effect_id",u[u.change_push_pvp_info=59]="change_push_pvp_info",u[u.change_forced_critical=60]="change_forced_critical",u[u.change_instance_skill_effect_info=61]="change_instance_skill_effect_info",u[u.change_skill_start_stage=62]="change_skill_start_stage",u[u.change_skill_effect_dir_target=63]="change_skill_effect_dir_target",u[u.change_stage_dir_rate=64]="change_stage_dir_rate",u[u.change_projection=65]="change_projection",u[u.change_skill_view=66]="change_skill_view",u[u.change_projectile_speed=67]="change_projectile_speed",u[u.change_projectile_dist=68]="change_projectile_dist",u[u.change_projectile_resourcescale=69]="change_projectile_resourcescale",u[u.change_projectile_max_target_hit_count=70]="change_projectile_max_target_hit_count",u[u.change_summon_trap_lifetime=71]="change_summon_trap_lifetime",u[u.change_summon_trap_destroy_delaytime=72]="change_summon_trap_destroy_delaytime",u[u.change_summon_trap_react_info=73]="change_summon_trap_react_info",u[u.change_summon_trap_invoke_effect=74]="change_summon_trap_invoke_effect",u[u.change_summon_trap_count=75]="change_summon_trap_count",u[u.enable_identity_event=76]="enable_identity_event",u[u.change_identity_proc_value=77]="change_identity_proc_value",u[u.change_skill_effect_identity_proc_info=78]="change_skill_effect_identity_proc_info",u[u.change_identity_proc_pvp_value=79]="change_identity_proc_pvp_value",u[u.change_skill_effect_identity_proc_pvp_info=80]="change_skill_effect_identity_proc_pvp_info",u[u.change_skill_effect_identity_proc_replace_info=81]="change_skill_effect_identity_proc_replace_info",u[u.change_skill_effect_identity_proc_replace_pvp_info=82]="change_skill_effect_identity_proc_replace_pvp_info",u[u.swap_chain_skill_effect=83]="swap_chain_skill_effect",u[u.swap_chain_combat_effect=84]="swap_chain_combat_effect",u[u.change_charge_scale=85]="change_charge_scale",u[u.change_summon_npc_id=86]="change_summon_npc_id",u[u.change_summon_npc_sight_range=87]="change_summon_npc_sight_range",u[u.change_summon_npc_pursuit_range=88]="change_summon_npc_pursuit_range",u[u.change_summon_npc_walk_movespeed=89]="change_summon_npc_walk_movespeed",u[u.change_summon_npc_battle_movespeed=90]="change_summon_npc_battle_movespeed",u[u.change_summon_npc_life_time=91]="change_summon_npc_life_time",u[u.change_summon_npc_ai_index=92]="change_summon_npc_ai_index",u[u.change_summon_npc_invincible_duration=93]="change_summon_npc_invincible_duration",u[u.change_summon_npc_acquire_identity=94]="change_summon_npc_acquire_identity",u[u.change_summon_npc_skill_id=95]="change_summon_npc_skill_id",u[u.change_summon_npc_die_skill_id=96]="change_summon_npc_die_skill_id",u[u.change_summon_npc_destroy_skill_id=97]="change_summon_npc_destroy_skill_id",u[u.change_summon_npc_spawn_buff_id=98]="change_summon_npc_spawn_buff_id",u[u.change_summon_npc_count=99]="change_summon_npc_count",u[u.change_summon_npc_stat=100]="change_summon_npc_stat",u[u.change_summon_npc_threat_point=101]="change_summon_npc_threat_point",u[u.change_summon_npc_skill_usable_tick=102]="change_summon_npc_skill_usable_tick",u[u.change_summon_npc_skill_use_order=103]="change_summon_npc_skill_use_order",u[u.change_combat_effect_arg=104]="change_combat_effect_arg",u[u.change_skill_effect_cost=105]="change_skill_effect_cost",u[u.change_accumulate_dam_rate=106]="change_accumulate_dam_rate",u[u.change_projectile_bank_data_addend=107]="change_projectile_bank_data_addend",u[u.change_identity_category=108]="change_identity_category",u[u.change_skill_slot_visible_effect=109]="change_skill_slot_visible_effect",u[u.change_attack_mask=110]="change_attack_mask",u[u.change_aim_target_max_range=111]="change_aim_target_max_range",u))(Ft||{}),Se=(r=>(r[r.none=0]="none",r[r.hp=1]="hp",r[r.mp=2]="mp",r[r.str=3]="str",r[r.agi=4]="agi",r[r.int=5]="int",r[r.con=6]="con",r[r.str_x=7]="str_x",r[r.agi_x=8]="agi_x",r[r.int_x=9]="int_x",r[r.con_x=10]="con_x",r[r.criticalhit=15]="criticalhit",r[r.specialty=16]="specialty",r[r.oppression=17]="oppression",r[r.rapidity=18]="rapidity",r[r.endurance=19]="endurance",r[r.mastery=20]="mastery",r[r.criticalhit_x=21]="criticalhit_x",r[r.specialty_x=22]="specialty_x",r[r.oppression_x=23]="oppression_x",r[r.rapidity_x=24]="rapidity_x",r[r.endurance_x=25]="endurance_x",r[r.mastery_x=26]="mastery_x",r[r.max_hp=27]="max_hp",r[r.max_mp=28]="max_mp",r[r.max_hp_x=29]="max_hp_x",r[r.max_mp_x=30]="max_mp_x",r[r.max_hp_x_x=31]="max_hp_x_x",r[r.max_mp_x_x=32]="max_mp_x_x",r[r.normal_hp_recovery=33]="normal_hp_recovery",r[r.combat_hp_recovery=34]="combat_hp_recovery",r[r.normal_hp_recovery_rate=35]="normal_hp_recovery_rate",r[r.combat_hp_recovery_rate=36]="combat_hp_recovery_rate",r[r.normal_mp_recovery=37]="normal_mp_recovery",r[r.combat_mp_recovery=38]="combat_mp_recovery",r[r.normal_mp_recovery_rate=39]="normal_mp_recovery_rate",r[r.combat_mp_recovery_rate=40]="combat_mp_recovery_rate",r[r.self_recovery_rate=41]="self_recovery_rate",r[r.drain_hp_dam_rate=42]="drain_hp_dam_rate",r[r.drain_mp_dam_rate=43]="drain_mp_dam_rate",r[r.dam_reflection_rate=44]="dam_reflection_rate",r[r.char_attack_dam=47]="char_attack_dam",r[r.skill_effect_dam_addend=48]="skill_effect_dam_addend",r[r.attack_power_rate=49]="attack_power_rate",r[r.skill_damage_rate=50]="skill_damage_rate",r[r.attack_power_rate_x=51]="attack_power_rate_x",r[r.skill_damage_rate_x=52]="skill_damage_rate_x",r[r.cooldown_reduction=53]="cooldown_reduction",r[r.paralyzation_point_rate=54]="paralyzation_point_rate",r[r.def=55]="def",r[r.res=56]="res",r[r.def_x=57]="def_x",r[r.res_x=58]="res_x",r[r.def_x_x=59]="def_x_x",r[r.res_x_x=60]="res_x_x",r[r.critical_physical_inc_rate=65]="critical_physical_inc_rate",r[r.critical_magical_inc_rate=66]="critical_magical_inc_rate",r[r.def_pen_rate=67]="def_pen_rate",r[r.res_pen_rate=68]="res_pen_rate",r[r.physical_inc_rate=69]="physical_inc_rate",r[r.magical_inc_rate=70]="magical_inc_rate",r[r.self_shield_rate=71]="self_shield_rate",r[r.hit_rate=72]="hit_rate",r[r.dodge_rate=73]="dodge_rate",r[r.critical_hit_rate=74]="critical_hit_rate",r[r.critical_res_rate=75]="critical_res_rate",r[r.critical_dam_rate=76]="critical_dam_rate",r[r.attack_speed=77]="attack_speed",r[r.attack_speed_rate=78]="attack_speed_rate",r[r.move_speed=79]="move_speed",r[r.move_speed_rate=80]="move_speed_rate",r[r.prop_move_speed=81]="prop_move_speed",r[r.prop_move_speed_rate=82]="prop_move_speed_rate",r[r.vehicle_move_speed=83]="vehicle_move_speed",r[r.vehicle_move_speed_rate=84]="vehicle_move_speed_rate",r[r.ship_move_speed=85]="ship_move_speed",r[r.ship_move_speed_rate=86]="ship_move_speed_rate",r[r.fire_dam_rate=87]="fire_dam_rate",r[r.ice_dam_rate=88]="ice_dam_rate",r[r.electricity_dam_rate=89]="electricity_dam_rate",r[r.earth_dam_rate=91]="earth_dam_rate",r[r.dark_dam_rate=92]="dark_dam_rate",r[r.holy_dam_rate=93]="holy_dam_rate",r[r.elements_dam_rate=94]="elements_dam_rate",r[r.fire_res_rate=95]="fire_res_rate",r[r.ice_res_rate=96]="ice_res_rate",r[r.electricity_res_rate=97]="electricity_res_rate",r[r.earth_res_rate=99]="earth_res_rate",r[r.dark_res_rate=100]="dark_res_rate",r[r.holy_res_rate=101]="holy_res_rate",r[r.elements_res_rate=102]="elements_res_rate",r[r.self_cc_time_rate=105]="self_cc_time_rate",r[r.enemy_cc_time_rate=106]="enemy_cc_time_rate",r[r.identity_value1=107]="identity_value1",r[r.identity_value2=108]="identity_value2",r[r.identity_value3=109]="identity_value3",r[r.awakening_dam_rate=110]="awakening_dam_rate",r[r.item_drop_rate=111]="item_drop_rate",r[r.gold_rate=112]="gold_rate",r[r.exp_rate=113]="exp_rate",r[r.attack_power_addend=123]="attack_power_addend",r[r.attack_power_addend_2=124]="attack_power_addend_2",r[r.npc_species_humanoid_dam_rate=125]="npc_species_humanoid_dam_rate",r[r.npc_species_devil_dam_rate=126]="npc_species_devil_dam_rate",r[r.npc_species_substance_dam_rate=127]="npc_species_substance_dam_rate",r[r.npc_species_undead_dam_rate=128]="npc_species_undead_dam_rate",r[r.npc_species_plant_dam_rate=129]="npc_species_plant_dam_rate",r[r.npc_species_insect_dam_rate=130]="npc_species_insect_dam_rate",r[r.npc_species_spirit_dam_rate=131]="npc_species_spirit_dam_rate",r[r.npc_species_wild_beast_dam_rate=132]="npc_species_wild_beast_dam_rate",r[r.npc_species_mechanic_dam_rate=133]="npc_species_mechanic_dam_rate",r[r.npc_species_ancient_dam_rate=134]="npc_species_ancient_dam_rate",r[r.npc_species_god_dam_rate=135]="npc_species_god_dam_rate",r[r.npc_species_archfiend_dam_rate=136]="npc_species_archfiend_dam_rate",r[r.vitality=137]="vitality",r[r.ship_booter_speed=138]="ship_booter_speed",r[r.ship_wreck_speed_rate=139]="ship_wreck_speed_rate",r[r.island_speed_rate=140]="island_speed_rate",r[r.attack_power_sub_rate_1=141]="attack_power_sub_rate_1",r[r.attack_power_sub_rate_2=142]="attack_power_sub_rate_2",r[r.physical_inc_sub_rate_1=143]="physical_inc_sub_rate_1",r[r.physical_inc_sub_rate_2=144]="physical_inc_sub_rate_2",r[r.magical_inc_sub_rate_1=145]="magical_inc_sub_rate_1",r[r.magical_inc_sub_rate_2=146]="magical_inc_sub_rate_2",r[r.skill_damage_sub_rate_1=147]="skill_damage_sub_rate_1",r[r.skill_damage_sub_rate_2=148]="skill_damage_sub_rate_2",r[r.resource_recovery_rate=149]="resource_recovery_rate",r[r.weapon_dam=151]="weapon_dam",r[r.weapon_dam_x=152]="weapon_dam_x",r))(Se||{});var De=(a=>(a[a.normal=0]="normal",a[a.hard=1]="hard",a[a.hellchaos=2]="hellchaos",a[a.challenge=3]="challenge",a[a.special=4]="special",a[a.extreme=5]="extreme",a))(De||{});var jr=require("tiny-typed-emitter");var Y,Re,U,Le,ln,ke,qt,fn=class extends jr.TypedEmitter{constructor(n,o,s=!0,i=!!process.env.DEV){super();J(this,Le);J(this,ke);$(this,"PartyStatusEffectRegistry");$(this,"LocalStatusEffectRegistry");J(this,Y,void 0);J(this,Re,void 0);J(this,U,void 0);$(this,"debug");$(this,"trace",!1);this.PartyStatusEffectRegistry=new Map,this.LocalStatusEffectRegistry=new Map,this.debug=i,ne(this,Y,n),ne(this,Re,o),ne(this,U,s)}getStatusEffectRegistryForPlayer(n,o){let s=this.getPlayerRegistry(o),i=s.get(n);if(i)return i;let a=new Map;return s.set(n,a),a}hasStatusEffectRegistryForPlayer(n,o){return this.getPlayerRegistry(o).has(n)}getPlayerRegistry(n){switch(n){case 1:return this.LocalStatusEffectRegistry;case 0:return this.PartyStatusEffectRegistry;default:break}return this.LocalStatusEffectRegistry}RemoveLocalObject(n,o){let s=this.LocalStatusEffectRegistry.get(n);if(s)for(let[,i]of s)this.RemoveStatusEffect(n,i.instanceId,1,void 0,o);this.LocalStatusEffectRegistry.delete(n)}RemovePartyObject(n,o){let s=this.PartyStatusEffectRegistry.get(n);if(s)for(let[,i]of s)this.RemoveStatusEffect(n,i.instanceId,0,void 0,o);this.PartyStatusEffectRegistry.delete(n)}RegisterStatusEffect(n){let o=this.getStatusEffectRegistryForPlayer(n.targetId,n.type),s=o.get(n.instanceId);s?g(this,U)&&s.expirationTimer&&(clearTimeout(s.expirationTimer),s.expirationTimer=void 0):n.effectType===0&&this.emit("shieldApplied",n),o.set(n.instanceId,n),this.SetupStatusEffectTimeout(n)}HasAnyStatusEffect(n,o,s,i){if(!this.hasStatusEffectRegistryForPlayer(n,o))return!1;let a=this.getStatusEffectRegistryForPlayer(n,o);for(let[,m]of a)if(!(!g(this,U)&&!this.IsReplayStatusEffectValidElseRemove(m,i))){for(let f of s)if(f===m.statusEffectId)return!0}return!1}IsReplayStatusEffectValidElseRemove(n,o){return n.expireAt===void 0||n.expireAt.getTime()>o.getTime()?!0:(this.ExpireStatusEffectByTimeout(n),!1)}HasAnyStatusEffectFromParty(n,o,s,i,a){if(!this.hasStatusEffectRegistryForPlayer(n,o))return!1;let m=this.getStatusEffectRegistryForPlayer(n,o);for(let[,f]of m)if(!(!g(this,U)&&!this.IsReplayStatusEffectValidElseRemove(f,a))&&i.includes(f.statusEffectId)){let l=g(this,Y).getPartyIdFromEntityId(f.sourceId);if(this.ValidForWholeRaid(f))return l!==void 0;if(l===s)return!0}return!1}RemoveStatusEffect(n,o,s,i,a){if(!this.hasStatusEffectRegistryForPlayer(n,s))return;let m=this.getStatusEffectRegistryForPlayer(n,s),f=m.get(o);return f&&(g(this,U)&&(clearTimeout(f.expirationTimer),f.expirationTimer=void 0),m.delete(o),i===4&&(g(this,U)||this.IsReplayStatusEffectValidElseRemove(f,a))&&this.RegisterValueUpdate(f,f.value,0)),f}GetStatusEffects(n,o,s,i){if(!this.hasStatusEffectRegistryForPlayer(n,o))return[];let a=this.getStatusEffectRegistryForPlayer(n,o);if(!g(this,U))for(let[,f]of a)this.IsReplayStatusEffectValidElseRemove(f,s);let m=[...a.values()];return i!==void 0?m.filter((f,l,k)=>f.sourceId===i):m}GetStatusEffectsFromParty(n,o,s,i){if(!this.hasStatusEffectRegistryForPlayer(n,o))return[];let a=this.getStatusEffectRegistryForPlayer(n,o);if(!g(this,U))for(let[,m]of a)this.IsReplayStatusEffectValidElseRemove(m,i);return[...a.values()].filter(m=>this.ValidForWholeRaid(m)?g(this,Y).getPartyIdFromEntityId(m.sourceId)!==void 0:s===g(this,Y).getPartyIdFromEntityId(m.sourceId))}Clear(n){let o=0;for(let[,i]of this.LocalStatusEffectRegistry){for(let[,a]of i)this.RemoveStatusEffect(a.targetId,a.instanceId,a.type,void 0,n);o+=i.size}let s=0;for(let[,i]of this.PartyStatusEffectRegistry){for(let[,a]of i)this.RemoveStatusEffect(a.targetId,a.instanceId,a.type,void 0,n);s+=i.size}this.trace&&console.log("On Clear SE in local",o,"in party",s),this.LocalStatusEffectRegistry.clear(),this.PartyStatusEffectRegistry.clear()}UpdateDuration(n,o,s,i){let m=this.getStatusEffectRegistryForPlayer(o,i).get(n);if(m){let f=s-m.timestamp;if(g(this,U)&&m.expirationTimer&&(this.trace&&console.log("Clearing timeout for",m.instanceId,"because of duration change"),clearTimeout(m.expirationTimer),m.expirationTimer=void 0),m.expireAt){let l=m.expireAt.getTime()+Number(f),k=l-m.pktTime.getTime();k>0?(this.trace&&console.log("Extending duration by",f,"ms","New timeout delay",k,"from",m.expireAt.toISOString(),"to",new Date(l).toISOString()),g(this,U)&&(m.expirationTimer=setTimeout(this.ExpireStatusEffectByTimeout.bind(this,m),k)),m.expireAt=new Date(l),m.timestamp=s):m.expireAt=void 0}}else this.debug&&console.error("Tried to update duration for SE with instanceId",n," on target",o,"but where is no such SE registered")}SyncStatusEffect(n,o,s,i,a){let m=he(this,ke,qt).call(this,o,a),f=m?0:1,l=m?o:s;if(!l)return;let h=this.getStatusEffectRegistryForPlayer(l,f).get(n);if(!h)return;let v=h.value;h.value=i,this.RegisterValueUpdate(h,v,i)}ValidForWholeRaid(n){return(n.buffCategory===3||n.buffCategory===1||n.buffCategory===2)&&n.category===1&&n.showType===1}SetupStatusEffectTimeout(n){if(n.expirationDelay>0&&n.expirationDelay<604800){let o=n.pktTime.getTime()>n.occurTime.getTime()?n.pktTime:n.occurTime,s=Math.ceil(n.expirationDelay*1e3),i=o.getTime()+s+fn.TIMEOUT_DELAY_MS-n.pktTime.getTime();n.expireAt=new Date(n.pktTime.getTime()+i),this.trace&&console.log("Setting up statuseffect expiration time for",n.name,n.instanceId,"to",n.expireAt.toISOString(),"with delay",i),g(this,U)&&(n.expirationTimer=setTimeout(this.ExpireStatusEffectByTimeout.bind(this,n),i))}}ExpireStatusEffectByTimeout(n){this.debug&&console.error("Triggered timeout on",n.name,"with iid",n.instanceId),this.RemoveStatusEffect(n.targetId,n.instanceId,n.type,void 0,new Date)}RegisterValueUpdate(n,o,s){n.effectType===0&&this.emit("shieldChanged",n,o,s)}newPC(n,o,s){let i=he(this,ke,qt).call(this,n.pcStruct.characterId,o);i?this.RemovePartyObject(n.pcStruct.characterId,s):this.RemoveLocalObject(n.pcStruct.playerId,s);for(let a of n.pcStruct.statusEffectDatas)this.RegisterStatusEffect(this.buildStatusEffect(a,i?n.pcStruct.characterId:n.pcStruct.playerId,a.sourceId,i?0:1,s))}buildStatusEffect(n,o,s,i,a){let m=n.value?n.value.readUInt32LE():0,f=n.value?n.value.readUInt32LE(8):0,l=m<f?m:f,k=0,h=0,v=0,G="Unknown",w=1,B=g(this,Re).skillBuff.get(n.statusEffectId);if(B){switch(G=B.name,B.category){case"debuff":k=1;break}switch(B.buffcategory){case"bracelet":h=1;break;case"etc":h=2;break;case"battleitem":h=3;break}switch(B.iconshowtype){case"all":v=1;break}switch(B.type){case"shield":w=0;break}}return{instanceId:n.effectInstanceId,sourceId:s,statusEffectId:n.statusEffectId,targetId:o,type:i,dbTarget:B?.target??"none",value:l,buffCategory:h,category:k,showType:v,expirationDelay:n.totalTime,expirationTimer:void 0,timestamp:n.endTick,expireAt:void 0,occurTime:n.occurTime,name:G,pktTime:a,effectType:w,stackCount:n.stackCount}}getStatusEffects(n,o,s,i){let a=[],m=[],f=he(this,Le,ln).call(this,n,s),l=this.GetStatusEffects(f?n.characterId:n.entityId,f?0:1,i,void 0);for(let k of l)m.push([k.statusEffectId,k.sourceId,k.stackCount]);if(o){let k=he(this,Le,ln).call(this,o,s),h=g(this,Y).isEntityInParty(n.entityId),v=h?g(this,Y).getPartyIdFromEntityId(n.entityId):void 0,G=h&&v?this.GetStatusEffectsFromParty(k?o.characterId:o.entityId,k?0:1,v,i):this.GetStatusEffects(k?o.characterId:o.entityId,k?0:1,i,n.entityId);for(let w of G)w.type===1&&w.category===1&&w.sourceId!==n.entityId&&w.dbTarget==="self"||a.push([w.statusEffectId,w.sourceId,w.stackCount])}return[m,a]}},ge=fn;Y=new WeakMap,Re=new WeakMap,U=new WeakMap,Le=new WeakSet,ln=function(n,o){if(n.entityType!==1)return!1;let s=n;return he(this,ke,qt).call(this,s.characterId,o)},ke=new WeakSet,qt=function(n,o){let s=g(this,Y).isCharacterInParty(o),i=g(this,Y).isCharacterInParty(n);if(s){if(!i||n===o)return!1;let a=g(this,Y).getPartyIdFromCharacterId(o),m=g(this,Y).getPartyIdFromCharacterId(n);return a===m}return!1},$(ge,"TIMEOUT_DELAY_MS",1e3);var Ut=class{#e;#o;#i;#a;entities=new Map;localPlayer;constructor(e,n,o,s){this.#e=e,this.#o=n,this.#i=o,this.#a=s,this.localPlayer={entityId:0n,entityType:1,name:"You",class:0,gearLevel:0,characterId:0n,stance:0,stats:new Map,skills:new Map,items:{}}}processNewPC(e){let n=e.parsed;if(!n)return;let o={entityId:n.pcStruct.playerId,entityType:1,name:n.pcStruct.name,class:n.pcStruct.classId,gearLevel:n.pcStruct.maxItemLevel,characterId:n.pcStruct.characterId,stance:0,stats:this.#a.getStatPairMap(n.pcStruct.statPair),skills:new Map,items:{}};this.entities.set(o.entityId,o);let s=this.#e.getEntityId(o.characterId);s&&this.#o.changeEntityId(s,n.pcStruct.playerId),this.#e.addMapping(o.characterId,o.entityId),this.#o.completeEntry(o.characterId,o.entityId),this.#i.newPC(n,this.localPlayer.characterId,e.time),o.itemSet=this.getPlayerSetOptions(n.pcStruct.equipItemDataList);let i=[];n.pcStruct.equipItemDataList.forEach(m=>{m.id!==void 0&&m.slot!==void 0&&i.push({id:m.id,slot:m.slot})}),o.items.equipList=i;let a=[];return n.pcStruct.equipLifeToolDataList.forEach(m=>{m.id!==void 0&&m.slot!==void 0&&a.push({id:m.id,slot:m.slot})}),o.items.lifeToolList=a,o}processInitEnv(e){let n=e.parsed;if(!n)return;this.localPlayer.entityId!==0n&&this.#o.changeEntityId(this.localPlayer.entityId,n.playerId),this.entities.clear();let o={entityId:n.playerId,entityType:1,name:this.localPlayer.name,class:this.localPlayer.class,gearLevel:this.localPlayer.gearLevel,characterId:this.localPlayer.characterId,stance:this.localPlayer.stance,stats:this.localPlayer.stats,skills:this.localPlayer.skills,items:this.localPlayer.items};this.localPlayer=o,this.entities.set(o.entityId,o),this.#e.clear(),this.#i.Clear(e.time),o.characterId!==0n&&this.#e.addMapping(o.characterId,o.entityId),this.localPlayer&&this.localPlayer.characterId&&this.localPlayer.characterId>0n&&this.#o.completeEntry(this.localPlayer.characterId,n.playerId)}processInitPC(e){let n=e.parsed;if(!n)return;this.entities.clear();let o={entityId:n.playerId,entityType:1,name:n.name,class:n.classId,gearLevel:n.gearLevel,characterId:n.characterId,stance:0,stats:this.#a.getStatPairMap(n.statPair),skills:new Map,items:n.characterId===this.localPlayer.characterId?this.localPlayer.items:{}};this.localPlayer=o,this.entities.set(o.entityId,o),this.#e.addMapping(o.characterId,o.entityId),this.#o.setOwnName(n.name),this.#o.completeEntry(o.characterId,n.playerId),this.#i.RemoveLocalObject(n.playerId,e.time);for(let s of n.statusEffectDatas){let i=this.getSourceEntity(s.sourceId);this.#i.RegisterStatusEffect(this.#i.buildStatusEffect(s,n.playerId,i.entityId,1,e.time))}return o}processNewNpc(e){let n=e.parsed;if(!n)return;let o=!1,s=this.#a.npc.get(n.npcStruct.typeId);s&&[6,7,9,10].includes(_n[s.grade])&&(o=!0);let i={entityId:n.npcStruct.objectId,entityType:2,name:s?.name??n.npcStruct.objectId.toString(16),typeId:n.npcStruct.typeId,isBoss:o,grade:s?.grade??"none",pushimmune:s?.pushimmune??!1,stats:this.#a.getStatPairMap(n.npcStruct.statPair),level:n.npcStruct.level,balanceLevel:n.npcStruct.balanceLevel??n.npcStruct.level},a=this.#a.getNpcEsther(n.npcStruct.typeId);a!==void 0&&(i.entityType=4,i.name=a.name,i.icon=a.icon),this.entities.set(i.entityId,i),this.#i.RemoveLocalObject(n.npcStruct.objectId,e.time);for(let m of n.npcStruct.statusEffectDatas){let f=this.getSourceEntity(m.sourceId);this.#i.RegisterStatusEffect(this.#i.buildStatusEffect(m,n.npcStruct.objectId,f.entityId,1,e.time))}return i}processNewNpcSummon(e){let n=e.parsed;if(!n)return;let o=!1,s=this.#a.npc.get(n.npcData.typeId);s&&["boss","raid","epic_raid","commander"].includes(s.grade)&&(o=!0);let i={entityId:n.npcData.objectId,entityType:3,name:s?.name??n.npcData.objectId.toString(16),ownerId:n.ownerId,typeId:n.npcData.typeId,isBoss:o,grade:s?.grade??"none",pushimmune:s?.pushimmune??!1,stats:this.#a.getStatPairMap(n.npcData.statPair),level:n.npcData.level,balanceLevel:n.npcData.balanceLevel??n.npcData.level};this.#i.RemoveLocalObject(n.npcData.objectId,e.time);for(let a of n.npcData.statusEffectDatas){let m=this.getSourceEntity(a.sourceId);this.#i.RegisterStatusEffect(this.#i.buildStatusEffect(a,n.npcData.objectId,m.entityId,1,e.time))}return this.entities.set(i.entityId,i),i}getPlayerSetOptions(e){let n=new Map;e.forEach(s=>{if(s.id&&s.slot&&s.slot>=1&&s.slot<=6){let i=this.#a.itemSet.items.get(s.id);if(i){let a=n.get(i.setname);a||(a=new Map,n.set(i.setname,a)),a.set(i.level,(a.get(i.level)??0)+1)}}});let o=[];return n.forEach((s,i)=>{let a=this.#a.itemSet.seteffects.get(i);if(!a)return;let m=0,f=0;for(let[l,k]of[...s.entries()].sort((h,v)=>v[0]-h[0])){let h=a.get(l);if(!h)return;for(let[v,G]of[...h.entries()])v>m&&k+f>=v&&(o.push(...G.options),m=Math.max(m,v));f=k}}),o}getSourceEntity(e){let n=this.entities.get(e);if((n?.entityType===5||n?.entityType===3)&&(e=n.ownerId),n=this.entities.get(e),n)return n;let o={entityId:e,entityType:2,name:e.toString(16),stats:new Map};return this.entities.set(e,o),o}guessIsPlayer(e,n){let o=this.#a.getSkillClassId(n);if(o!==0){let s;if(e.entityType===1){let i=e;if(i.class===o)return i;s={entityId:i.entityId,entityType:1,name:i.name,class:o,gearLevel:i.gearLevel,characterId:i.characterId,stance:i.stance,stats:i.stats,skills:new Map,items:{}}}else s={entityId:e.entityId,entityType:1,name:e.name,class:o,gearLevel:0,characterId:0n,stance:0,stats:new Map,skills:new Map,items:{}};return this.entities.set(e.entityId,s),s}return e}getOrCreateEntity(e){let n=this.entities.get(e);return n||(n={entityId:e,entityType:0,name:e.toString(16),stats:new Map},this.entities.set(e,n)),n}getEntityByName(e){return[...this.entities.values()].find(n=>n.name===e)}};var Su=require("tiny-typed-emitter");var pu=require("crypto");var hu=nm(require("axios"));var d=class{b;o;constructor(e){this.b=e,this.o=0}skip(e=0){this.o+=e}bool(){return this.u8()===1}u8(){return this.b.readUint8(this.o++)}i8(){return this.b.readInt8(this.o++)}u16(){let e=this.b.readUint16LE(this.o);return this.o+=2,e}i16(){let e=this.b.readInt16LE(this.o);return this.o+=2,e}u32(){let e=this.b.readUint32LE(this.o);return this.o+=4,e}i32(){let e=this.b.readInt32LE(this.o);return this.o+=4,e}f32(){let e=this.b.readFloatLE(this.o);return this.o+=4,e}u64(){let e=this.b.readBigUint64LE(this.o);return this.o+=8,e}i64(){let e=this.b.readBigInt64LE(this.o);return this.o+=8,e}string(e){let n=this.u16();if(n<=e){n=n*2;let o=this.b.toString("utf16le",this.o,this.o+n);return this.o+=n,o}return""}bytes(e=0,n,o){if(n&&e>n)return Buffer.alloc(0);o&&(e=e*o);let s=Buffer.from(this.b.subarray(this.o,this.o+e));return this.o+=e,s}array(e,n,o){return o&&e>o?[]:new Array(e).fill(void 0).map(n)}},Vt=class{b;o;constructor(e=65535){this.b=Buffer.allocUnsafe(e),this.o=0}get value(){return this.b.subarray(0,this.o)}skip(e=0){this.o+=e}bool(e=!1){return this.u8(e?1:0),e}u8(e=0){this.b.writeUInt8(e,this.o++)}i8(e=0){this.b.writeInt8(e,this.o++)}u16(e=0){this.o=this.b.writeUInt16LE(e,this.o)}i16(e=0){this.o=this.b.writeInt16LE(e,this.o)}u32(e=0){this.o=this.b.writeUInt32LE(e,this.o)}i32(e=0){this.o=this.b.writeInt32LE(e,this.o)}f32(e=0){this.o=this.b.writeFloatLE(e,this.o)}u64(e=0n){this.o=this.b.writeBigUInt64LE(BigInt(e),this.o)}i64(e=0n){this.o=this.b.writeBigInt64LE(BigInt(e),this.o)}string(e="",n=0){this.u16(e.length),e.length<=n&&(this.o+=this.b.write(e,this.o,"utf16le"))}bytes(e=Buffer.alloc(0),n={}){if(n.maxLen){let o=n.multiplier??1;if(e.length%o)throw new Error(`Error writing bytes, chunkSize should be a multiple of intut value size, got ${e.length}%${o}`);let s=e.length/o;if(s>n.maxLen)throw new Error(`Error writing bytes, input value size exceeded maxLen, got ${s} > ${n.maxLen}`);if(!n.lenType)throw new Error(`Error writing bytes, invalid lenType when writing chunks, got ${n.lenType}`);this[n.lenType](s)}else if(n.length&&e.length!==n.length)throw new Error(`Error writing bytes, input value size doesn't match opts.length, ${e.length} !== ${n.lenType}`);this.o+=e.copy(this.b,this.o)}array(e=[],n,o){if(e===void 0||e.length>n.maxLen){this[n.lenType](0);return}this[n.lenType](e.length),e.forEach(o)}};var oe=class{time;#e;#o;#i;#a;constructor(...e){if(e.length===5){let[n,o,s,i,a]=e;this.#o=n,this.time=s,this.#e=o,this.#i=i,this.#a=a}else if(e.length===3){let[n,o,s]=e;this.#o=Buffer.alloc(0),this.time=new Date,this.#e=o,this.#i=()=>n,this.#a=s}else throw new Error("[meter-core/logger/parser] - LogEvent<T>: Invalid constructor arguments")}#n;get parsed(){if(!this.#n)try{this.#n=this.#i(new d(this.#o))}catch(e){console.error(`[meter-core/logger/parser] - parsed - ${e}`);return}return this.#n}#t;get serialized(){if(!this.#t)try{if(!this.parsed)return;let e=new Vt;e.skip(Wr),this.#a(e,this.parsed);let n=e.value;n.writeUint16LE(n.length,Fr),n.writeUint16LE(this.#e,pn),n.writeUintLE(+new Date,qr,hn),this.#t=e.value}catch(e){console.error(`[meter-core/logger/parser] - serialized - ${e}`);return}return this.#t}},cn=6,Or=2,Fr=0,dn=2,pn=Fr+Or,hn=6,qr=pn+dn,Wr=Or+dn+hn;function be(t,e){let n={};return n.points=t.u16(),n.id=t.u32(),n.level=t.u8(),n}function Pe(t,e){t.u16(e.points),t.u32(e.id),t.u8(e.level)}function kn(t,e){let n={};return n.abilityDataList=t.array(t.u16(),()=>be(t,e),100),n}function bn(t,e){t.array(e.abilityDataList,{maxLen:100,lenType:"u16"},n=>{Pe(t,n)})}var Pn="AbilityChangeNotify";function Ur(t,e){let n={};return n.featureType=t.u16(),n.level=t.u32(),n}function Vr(t,e){t.u16(e.featureType),t.u32(e.level)}function vn(t,e){let n={};return n.activeAbilityList=t.array(t.u16(),()=>Ur(t,e),60),n.objectId=t.u64(),n}function Tn(t,e){t.array(e.activeAbilityList,{maxLen:60,lenType:"u16"},n=>{Vr(t,n)}),t.u64(e.objectId)}var In="ActiveAbilityNotify";function En(t,e){let n={};return n.objectId=t.u64(),n.addonSkillFeatureList=t.array(t.u16(),()=>{let o={};return o.addonSkillFeatureIdList=t.array(t.u16(),()=>t.u32(),5),o.skillId=t.u32(),o},200),n}function xn(t,e){t.u64(e.objectId),t.array(e.addonSkillFeatureList,{maxLen:200,lenType:"u16"},n=>{t.array(n.addonSkillFeatureIdList,{maxLen:5,lenType:"u16"},o=>{t.u32(o)}),t.u32(n.skillId)})}var Nn="AddonSkillFeatureChangeNotify";function Dn(t,e){let n={};return n.paralyzationMaxPoint=t.u32(),n.type=t.u8(),n.objectId=t.u64(),n.paralyzationPoint=t.u32(),n}function gn(t,e){t.u32(e.paralyzationMaxPoint),t.u8(e.type),t.u64(e.objectId),t.u32(e.paralyzationPoint)}var Rn="BlockSkillStateNotify";function Ln(t,e){let n={};return n.sourceId=t.u64(),n.targetId=t.u64(),n.type=t.u32(),n}function wn(t,e){t.u64(e.sourceId),t.u64(e.targetId),t.u32(e.type)}var An="CounterAttackNotify";function Kn(t,e){let n={};return n.sourceId=t.u64(),n.targetId=t.u64(),e>=4?(n.effectId=t.u32(),n.directionYaw=t.u16(),n.deathType=t.u8(),n.durabilityDecrement=t.u8(),n.abnormalStatusType=t.u8(),n.damageAttr=t.u8(),n.unk0_m=t.u64(),n.unk2_m=t.u32()):(n.effectId=0,n.directionYaw=0,n.deathType=0,n.durabilityDecrement=0,n.abnormalStatusType=0,n.damageAttr=0,n.unk0_m=0n,n.unk2_m=0),n}function Bn(t,e){t.u64(e.sourceId),t.u64(e.targetId),t.u32(e.effectId),t.u16(e.directionYaw),t.u8(e.deathType??0),t.u8(e.durabilityDecrement),t.u8(e.abnormalStatusType??0),t.u8(e.damageAttr??0),t.u64(e.unk0_m),t.u32(e.unk2_m)}var Cn="DeathNotify";function Mn(t,e){let n={};return n.abilityDataList=t.array(t.u16(),()=>be(t,e),100),n}function jn(t,e){t.array(e.abilityDataList,{maxLen:100,lenType:"u16"},n=>{Pe(t,n)})}var On="InitAbility";function Fn(t,e){let n={};return n.playerId=t.u64(),n}function qn(t,e){t.u64(e.playerId)}var Wn="InitEnv";var im=[0,31,28,31,30,31,30,31,31,30,31,30,31];function rm(t){return!(t%4||!(t%100)&&t%400)}function um(t,e,n){if(t>99){if(t<1752||t==1752&&(e<9||e==9&&n<<14))return!1}else t+=1900;return n>0&&e<=12&&(n<=im[e]||n==29&&e==2&&rm(t))}function Un(t){let e=Number(t&0xffffffffn),n=Number(t>>32n&0xffffffffn),o=e&4095,s=(e&65535)>>12,i=e>>16&31;um(o,s,i)||(o=s=i=0);let a=e>>21&31,m=e>>26&63,f=n&63,l=n>>6&16383;return a<24&&m<60&&f<60&&l<1e3||(a=24,m=f=l=0),new Date(Date.UTC(o<=99?o+1900:o,s-1,i,a,m,f,l))}function Zr(t){let e=0n;return e|=BigInt(t.getUTCMilliseconds())<<38n,e|=BigInt(t.getUTCSeconds())<<32n,e|=BigInt(t.getUTCMinutes())<<26n,e|=BigInt(t.getUTCHours())<<21n,e|=BigInt(t.getUTCDate())<<16n,e|=BigInt(t.getUTCMonth()+1)<<12n,e|=BigInt(t.getUTCFullYear()<2e3?t.getUTCFullYear()-1900:t.getUTCFullYear()),e}function W(t,e=0){let n=t.u16();return(n&4095)<2079?(t.o-=2,Un(t.i64())):Un(BigInt(n)&0xfffn|0x11000n)}function re(t,e=Un(0x1181fn)){e.getUTCFullYear()>=2079?t.u16(Number(Zr(e)&0xffffn)):t.i64(Zr(e))}function V(t,e){let n={};return n.skillLevel=t.u8(),n.occurTime=W(t,e),n.statusEffectId=t.u32(),n.sourceId=t.u64(),n.totalTime=t.f32(),n.endTick=t.u64(),t.bool()&&(n.value=t.bytes(16)),n.effectInstanceId=t.u32(),e>=1?n.stackCount=t.u8():n.stackCount=1,n}function Z(t,e){t.u8(e.skillLevel),re(t,e.occurTime),t.u32(e.statusEffectId),t.u64(e.sourceId),t.f32(e.totalTime),t.u64(e.endTick),t.bool(e.value!==void 0)&&t.bytes(e.value,{length:16}),t.u32(e.effectInstanceId),t.u8(e.stackCount)}function mm(t){if(t.length===0)return 0n;if(t.length>8)throw new Error("Value is too large");let e=Buffer.alloc(8);return t.copy(e),e.readBigInt64LE()}function T(t,e=0){let n=t.u8(),o=t.bytes(n>>1&7),s=mm(o)<<4n|BigInt(n>>4);return n&1?-s:s}function M(t,e=0n){let n=Buffer.alloc(8),o=e<0n;n.writeBigInt64LE((o?-e:e)>>4n);let s=0;for(let[i,a]of n.entries())a!=0&&(s=i+1);if(s>7)throw new Error("Value is too large");t.u8(Number((o?-e:e)&0xfn)<<4|(s&7)<<1|(o?1:0)),t.bytes(n.subarray(0,s),{length:s})}function Vn(t,e){let n={};return n.statPair=t.array(t.u16(),()=>{let o={};return o.StatType=t.u8(),o.Value=T(t,e),o},152),n.name=t.string(20),n.level=t.u16(),n.statusEffectDatas=t.array(t.u16(),()=>V(t,e),80),n.characterId=t.u64(),n.gearLevel=t.f32(),n.playerId=t.u64(),n.classId=t.u16(),n}function Zn(t,e){t.array(e.statPair,{maxLen:152,lenType:"u16"},n=>{t.u8(n.statType),M(t,n.value)}),t.string(e.name,20),t.u16(e.level),t.array(e.statusEffectDatas,{maxLen:80,lenType:"u16"},n=>{Z(t,n)}),t.u64(e.characterId),t.f32(e.gearLevel),t.u64(e.playerId),t.u16(e.classId)}var zn="InitPC";function Hn(t,e){let n={};return n.statPair=t.array(t.u16(),()=>{let o={};return o.statType=t.u8(),o.value=T(t,e),o},152),n.statusEffectDatas=t.array(t.u16(),()=>V(t,e),80),n.addonSkillFeatureList=t.array(t.u16(),()=>{let o={};return o.addonSkillFeatureIdList=t.array(t.u16(),()=>t.u32(),5),o.skillId=t.u32(),o},200),n.abilityDataList=t.array(t.u16(),()=>be(t,e),100),n}function Gn(t,e){t.array(e.statPair,{maxLen:152,lenType:"u16"},n=>{t.u8(n.statType),M(t,n.value)}),t.array(e.statusEffectDatas,{maxLen:80,lenType:"u16"},n=>{Z(t,n)}),t.array(e.addonSkillFeatureList,{maxLen:200,lenType:"u16"},n=>{t.array(n.addonSkillFeatureIdList,{maxLen:5,lenType:"u16"},o=>{t.u32(o)}),t.u32(n.skillId)}),t.array(e.abilityDataList,{maxLen:100,lenType:"u16"},n=>{Pe(t,n)})}var Yn="InitLocal";function $n(t,e){let n={};return n.account_CharacterId1=t.u64(),n.serverAddr=t.string(256),n.account_CharacterId2=t.u64(),n}function we(t,e){t.u64(e.account_CharacterId1),t.string(e.serverAddr,256),t.u64(e.account_CharacterId2)}var Qn="MigrationExecute";function Jn(t){return t>>20===1?-((~t>>>0)+1&2097151):t}function N(t,e=0){let n=t.u64();return{x:Jn(Number(n&0x1fffffn)),y:Jn(Number(n>>21n&0x1fffffn)),z:Jn(Number(n>>42n&0x1fffffn))}}function F(t,e={x:0,y:0,z:0}){t.u64(BigInt(Math.round(e.x??0)>>>0&2097151)|BigInt(Math.round(e.y??0)>>>0&2097151)<<21n|BigInt(Math.round(e.z??0)>>>0&2097151)<<42n)}function K(t,e=0){return t.u16()*(2*Math.PI)/65536}function X(t,e=0){t.u16(Math.round(e*65536/(2*Math.PI))%65536)}function Zt(t,e){let n={};return n.spawnIndex=t.u32(),n.objectId=t.u64(),t.bool()&&(n.transitIndex=t.u32()),n.position=N(t,e),n.statusEffectDatas=t.array(t.u16(),()=>V(t,e),80),n.directionYaw=K(t,e),n.statPair=t.array(t.u16(),()=>{let o={};return o.statType=t.u8(),o.value=T(t,e),o},152),n.typeId=t.u32(),e>=1?(n.level=t.u16(),t.bool()&&(n.balanceLevel=t.u16())):n.level=0,n}function zt(t,e){t.u32(e.spawnIndex),t.u64(e.objectId),t.bool(e.transitIndex!==void 0)&&t.u32(e.transitIndex),F(t,e.position),t.array(e.statusEffectDatas,{maxLen:80,lenType:"u16"},n=>{Z(t,n)}),X(t,e.directionYaw),t.array(e.statPair,{maxLen:152,lenType:"u16"},n=>{t.u8(n.statType),M(t,n.value)}),t.u32(e.typeId),t.u16(e.level),t.bool(e.balanceLevel!==void 0)&&t.u16(e.balanceLevel)}function Xn(t,e){let n={};return n.npcStruct=Zt(t,e),n}function yn(t,e){zt(t,e.npcStruct)}var eo="NewNpc";function to(t,e){let n={};return n.publishReason=t.u8(),n.ownerId=t.u64(),n.npcData=Zt(t,e),n}function no(t,e){t.u8(e.publishReason),t.u64(e.ownerId),zt(t,e.npcData)}var oo="NewNpcSummon";function _e(t,e){let n={};return n.slot=t.u16(),n.level=t.u16(),n.itemTint=t.bytes(t.u16(),3,14),n.expireTime=W(t),n.id=t.u32(),n}function le(t,e){t.u16(e.slot),t.u16(e.level),t.bytes(e.itemTint,{maxLen:3,lenType:"u16",multiplier:14}),re(t,e.expireTime),t.u32(e.id)}function Hr(t,e){let n={};return n.maxItemLevel=t.f32(),n.statPair=t.array(t.u16(),()=>{let o={};return o.statType=t.u8(),o.value=T(t,e),o},152),n.name=t.string(20),n.heading=K(t,e),n.characterId=t.u64(),n.playerId=t.u64(),n.addonSkillFeatureList=t.array(t.u16(),()=>{let o={};return o.addonSkillFeatureIdList=t.array(t.u16(),()=>t.u32(),5),o.skillId=t.u32(),o},200),n.classId=t.u16(),n.level=t.u16(),n.statusEffectDatas=t.array(t.u16(),()=>V(t,e),80),e>=1?(n.avgItemLevel=t.f32(),n.position=N(t),n.equipItemDataList=t.array(t.u16(),()=>_e(t,e),32),n.equipLifeToolDataList=t.array(t.u16(),()=>_e(t,e),9),n.guildName=t.string(20),e>=2?n.guildId=t.u64():n.guildId=BigInt(t.u32())):(n.avgItemLevel=n.maxItemLevel,n.position={x:0,y:0,z:0},n.equipItemDataList=[],n.equipLifeToolDataList=[],n.guildName="",n.guildId=0n),n}function Gr(t,e){t.f32(e.maxItemLevel),t.array(e.statPair,{maxLen:152,lenType:"u16"},n=>{t.u8(n.statType),M(t,n.value)}),t.string(e.name,20),X(t,e.heading),t.u64(e.characterId),t.u64(e.playerId),t.array(e.addonSkillFeatureList,{maxLen:200,lenType:"u16"},n=>{t.array(n.addonSkillFeatureIdList,{maxLen:5,lenType:"u16"},o=>{t.u32(o)}),t.u32(n.skillId)}),t.u16(e.classId),t.u16(e.level),t.array(e.statusEffectDatas,{maxLen:80,lenType:"u16"},n=>{Z(t,n)}),t.f32(e.avgItemLevel),F(t,e.position),t.array(e.equipItemDataList,{maxLen:32,lenType:"u16"},n=>{le(t,n)}),t.array(e.equipLifeToolDataList,{maxLen:9,lenType:"u16"},n=>{le(t,n)}),t.string(e.guildName,20),t.u64(e.guildId)}function so(t,e){let n={};return n.pcStruct=Hr(t,e),n}function io(t,e){Gr(t,e.pcStruct)}var ro="NewPC";function ve(t,e=0){return{first:t.u8(),second:t.u8(),third:t.u8()}}function Ht(t,e){t.u8(e.first),t.u8(e.second),t.u8(e.third)}function Te(t,e=0){return{first:t.u16(),second:t.u16(),third:t.u16()}}function Gt(t,e){t.u16(e.first),t.u16(e.second),t.u16(e.third)}function Yr(t,e){let n={};return n.tripodIndex=ve(t,e),n.chainSkillEffect=t.u32(),n.skillEffect=t.u32(),n.skillId=t.u32(),n.targetObjectId=t.u64(),n.ownerId=t.u64(),n.skillLevel=t.u8(),n.projectileId=t.u64(),n.tripodLevel=Te(t,e),n}function $r(t,e){Ht(t,e.tripodIndex),t.u32(e.chainSkillEffect),t.u32(e.skillEffect),t.u32(e.skillId),t.u64(e.targetObjectId),t.u64(e.ownerId),t.u8(e.skillLevel),t.u64(e.projectileId),Gt(t,e.tripodLevel)}function _o(t,e){let n={};return n.projectileInfo=Yr(t,e),n}function lo(t,e){$r(t,e.projectileInfo)}var fo="NewProjectile";function co(t,e){let n={};return n.enable=t.bool(),n.paralyzationPoint=t.u32(),n.decreasePoint=t.u32(),n.paralyzationMaxPoint=t.u32(),n.noHitCheckTime=t.u32(),n.hitCheckTime=t.u32(),n.objectId=t.u64(),n}function po(t,e){t.bool(e.enable),t.u32(e.paralyzationPoint),t.u32(e.decreasePoint),t.u32(e.paralyzationMaxPoint),t.u32(e.noHitCheckTime),t.u32(e.hitCheckTime),t.u64(e.objectId)}var ho="ParalyzationStateNotify";function Qr(t,e){let n={};return n.maxHp=T(t,e),n.characterId=t.u64(),n.position=N(t,e),n.transitIndex=t.u32(),n.curHp=T(t,e),n.characterLevel=t.u16(),n.gearLevel=t.f32(),n.zoneId=t.u32(),n.partyMemberNumber=t.u8(),n.name=t.string(20),n.zoneInstId=t.u64(),n.worldId=t.u8(),n.classId=t.u16(),n.auths=t.u8(),n}function Jr(t,e){M(t,e.maxHp),t.u64(e.characterId),F(t,e.position),t.u32(e.transitIndex),M(t,e.curHp),t.u16(e.characterLevel),t.f32(e.gearLevel),t.u32(e.zoneId),t.u8(e.partyMemberNumber),t.string(e.name,20),t.u64(e.zoneInstId),t.u8(e.worldId),t.u16(e.classId),t.u8(e.auths)}function So(t,e){let n={};return n.raidInstanceId=t.u32(),n.lootGrade=t.u32(),n.partyType=t.u8(),n.partyInstanceId=t.u32(),n.partyLootType=t.u8(),n.memberDatas=t.array(t.u16(),()=>Qr(t,e),40),n}function ko(t,e){t.u32(e.raidInstanceId),t.u32(e.lootGrade),t.u8(e.partyType),t.u32(e.partyInstanceId),t.u8(e.partyLootType),t.array(e.memberDatas,{maxLen:40,lenType:"u16"},n=>{Jr(t,n)})}var bo="PartyInfo";function Po(t,e){let n={};return n.partyLeaveType=t.u8(),n.partyInstanceId=t.u32(),n.name=t.string(20),n}function vo(t,e){t.u8(e.partyLeaveType),t.u32(e.partyInstanceId),t.string(e.name,20)}var To="PartyLeaveResult";function Io(t,e){let n={};return n.objectId=t.u64(),n.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),n.unk0_m=t.u8(),n}function Eo(t,e){t.u64(e.objectId),t.array(e.passiveStatusEffectList,{maxLen:10,lenType:"u16"},n=>{t.u32(n)}),t.u8(e.unk0_m)}var xo="PartyPassiveStatusEffectAddNotify";function No(t,e){let n={};return n.objectId=t.u64(),n.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),n}function Do(t,e){t.u64(e.objectId),t.array(e.passiveStatusEffectList,{maxLen:10,lenType:"u16"},n=>{t.u32(n)})}var go="PartyPassiveStatusEffectRemoveNotify";function Ro(t,e){let n={};return n.characterId=t.u64(),n.statusEffectDatas=t.array(t.u16(),()=>V(t,e),80),n.playerIdOnRefresh=t.u64(),n}function Lo(t,e){t.u64(e.characterId),t.array(e.statusEffectDatas,{maxLen:80,lenType:"u16"},n=>{Z(t,n)}),t.u64(e.playerIdOnRefresh)}var wo="PartyStatusEffectAddNotify";function Ao(t,e){let n={};return n.characterId=t.u64(),n.statusEffectIds=t.array(t.u16(),()=>t.u32(),80),n.reason=t.u8(),n}function Ko(t,e){t.u64(e.characterId),t.array(e.statusEffectIds,{maxLen:80,lenType:"u16"},n=>{t.u32(n)}),t.u8(e.reason)}var Bo="PartyStatusEffectRemoveNotify";function Co(t,e){let n={};return n.partyInstanceId=t.u32(),n.raidInstanceId=t.u32(),n.characterId=t.u64(),n}function Mo(t,e){t.u32(e.partyInstanceId),t.u32(e.raidInstanceId),t.u64(e.characterId)}var jo="PartyStatusEffectResultNotify";function Oo(t,e){let n={};return n.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),n}function Fo(t,e){t.array(e.passiveStatusEffectList,{maxLen:10,lenType:"u16"},n=>{t.u32(n)})}var qo="PassiveStatusEffectAddNotify";function Wo(t,e){let n={};return n.passiveStatusEffectList=t.array(t.u16(),()=>t.u32(),10),n}function Uo(t,e){t.array(e.passiveStatusEffectList,{maxLen:10,lenType:"u16"},n=>{t.u32(n)})}var Vo="PassiveStatusEffectRemoveNotify";function Zo(t,e){let n={};return e>=4?n.typeId=t.u32():n.typeId=0,n}function zo(t,e){t.u32(e.typeId)}var Ho="RaidBossKillNotify";function Go(t,e){let n={};return e>=3?n.raidResult=t.u8():n.raidResult=0,n}function Yo(t,e){t.u8(e.raidResult)}var $o="RaidResult";function Xr(t,e){let n={};return n.unpublishReason=t.u8(),n.objectId=t.u64(),n}function yr(t,e){t.u8(e.unpublishReason),t.u64(e.objectId)}function Qo(t,e){let n={};return n.unpublishedObjects=t.array(t.u16(),()=>Xr(t,e),200),n}function Jo(t,e){t.array(e.unpublishedObjects,{maxLen:200,lenType:"u16"},n=>{yr(t,n)})}var Xo="RemoveObject";function Yt(t,e=0){let n={},o=t.u8();return o&1&&(n.moveTime=t.u32()),o&2&&(n.standUpTime=t.u32()),o&4&&(n.downTime=t.u32()),o&8&&(n.freezeTime=t.u32()),o&16&&(n.moveHeight=t.u32()),o&32&&(n.farmostDist=t.u32()),o&64&&(n.flag40=t.bytes(t.u16(),6)),n}function eu(t,e){let n=(e.moveTime===void 0?0:1)|(e.standUpTime===void 0?0:2)|(e.downTime===void 0?0:4)|(e.freezeTime===void 0?0:8)|(e.moveHeight===void 0?0:16)|(e.farmostDist===void 0?0:32)|(e.flag40===void 0?0:64);t.u8(n),n&1&&t.u32(e.moveTime),n&2&&t.u32(e.standUpTime),n&4&&t.u32(e.downTime),n&8&&t.u32(e.freezeTime),n&16&&t.u32(e.moveHeight),n&32&&t.u32(e.farmostDist),n&64&&t.bytes(e.flag40,{maxLen:6,lenType:"u16"})}function $t(t,e){let n={};return n.modifier=t.u8(),n.targetId=t.u64(),n.damageType=t.u8(),t.bool()&&(n.damageAttr=t.u8()),n.curHp=T(t,e),n.unk3_m=t.u16(),n.maxHp=T(t,e),n.damage=T(t,e),n}function Qt(t,e){t.u8(e.modifier),t.u64(e.targetId),t.u8(e.damageType),t.bool(e.damageAttr!==void 0)&&t.u8(e.damageAttr),M(t,e.curHp),t.u16(e.unk3_m),M(t,e.maxHp),M(t,e.damage)}function ou(t,e){let n={};return n.skillMoveOptionData=Yt(t,e),n.destination=N(t,e),n.position=N(t,e),n.skillDamageEvent=$t(t,e),n}function au(t,e){eu(t,e.skillMoveOptionData),F(t,e.destination),F(t,e.position),Qt(t,e.skillDamageEvent)}function yo(t,e){let n={};return n.skillId=t.u32(),n.skillDamageAbnormalMoveEvents=t.array(t.u16(),()=>ou(t,e),50),n.skillEffectId=t.u32(),n.sourceId=t.u64(),n}function ea(t,e){t.u32(e.skillId),t.array(e.skillDamageAbnormalMoveEvents,{maxLen:50,lenType:"u16"},n=>{au(t,n)}),t.u32(e.skillEffectId),t.u64(e.sourceId)}var ta="SkillDamageAbnormalMoveNotify";function na(t,e){let n={};return n.skillLevel=t.u8(),n.sourceId=t.u64(),n.skillId=t.u32(),n.skillDamageEvents=t.array(t.u16(),()=>$t(t,e),50),n.skillEffectId=t.u32(),n}function oa(t,e){t.u8(e.skillLevel),t.u64(e.sourceId),t.u32(e.skillId),t.array(e.skillDamageEvents,{maxLen:50,lenType:"u16"},n=>{Qt(t,n)}),t.u32(e.skillEffectId??0)}var aa="SkillDamageNotify";function sa(t,e){let n={};return n.sourceId=t.u64(),n.skillId=t.u32(),n.stage=t.u8(),n}function ia(t,e){t.u64(e.sourceId),t.u32(e.skillId),t.u8(e.stage)}var ra="SkillStageNotify";function Jt(t,e=0){let n={},o=t.u8();return o&1&&(n.layerIndex=t.u8()),o&2&&(n.startStageIndex=t.u8()),o&4&&(n.transitIndex=t.u32()),o&8&&(n.stageStartTime=t.u32()),o&16&&(n.farmostDistance=t.u32()),o&32&&(n.tripodIndex=ve(t)),o&64&&(n.tripodLevel=Te(t)),n}function su(t,e){let n=(e.layerIndex===void 0?0:1)|(e.startStageIndex===void 0?0:2)|(e.transitIndex===void 0?0:4)|(e.stageStartTime===void 0?0:8)|(e.farmostDistance===void 0?0:16)|(e.tripodIndex===void 0?0:32)|(e.tripodLevel===void 0?0:64);t.u8(n),n&1&&t.u8(e.layerIndex),n&2&&t.u8(e.startStageIndex),n&4&&t.u32(e.transitIndex),n&8&&t.u32(e.stageStartTime),n&16&&t.u32(e.farmostDistance),n&32&&Ht(t,e.tripodIndex),n&64&&Gt(t,e.tripodLevel)}function ua(t,e){let n={};return n.sourceId=t.u64(),n.curDirectionYaw=K(t,e),n.newDirectionYaw=K(t,e),n.aimTargetPosition=N(t,e),t.bool()&&(n.pitchRotation=K(t,e)),t.bool()&&(n.aiStateId=t.u32()),n.curPosition=N(t,e),t.bool()&&(n.unk1_m=t.u32()),n.skillLevel=t.u8(),n.newPosition=N(t,e),n.skillId=t.u32(),n.skillOptionData=Jt(t,e),n}function ma(t,e){t.u64(e.sourceId),X(t,e.curDirectionYaw),X(t,e.newDirectionYaw),F(t,e.aimTargetPosition),t.bool(e.pitchRotation!==void 0)&&X(t,e.pitchRotation),t.bool(e.aiStateId!==void 0)&&t.u32(e.aiStateId),F(t,e.curPosition),t.bool(e.unk1_m!==void 0)&&t.u32(e.unk1_m),t.u8(e.skillLevel),F(t,e.newPosition),t.u32(e.skillId),su(t,e.skillOptionData)}var _a="SkillStartNotify";function la(t,e){let n={};return n.statusEffectData=V(t,e),n.objectId=t.u64(),n.new=t.bool(),n}function fa(t,e){Z(t,e.statusEffectData),t.u64(e.objectId),t.bool(e.new)}var ca="StatusEffectAddNotify";function da(t,e){let n={};return n.statusEffectIds=t.array(t.u16(),()=>t.u32(),80),n.objectId=t.u64(),n.reason=t.u8(),n}function pa(t,e){t.array(e.statusEffectIds,{maxLen:80,lenType:"u16"},n=>{t.u32(n)}),t.u64(e.objectId),t.u8(e.reason)}var ha="StatusEffectRemoveNotify";function Sa(t,e){let n={};return n.effectInstanceId=t.u32(),n.targetId=t.u64(),n.expirationTick=t.u64(),n}function ka(t,e){t.u32(e.effectInstanceId),t.u64(e.targetId),t.u64(e.expirationTick)}var ba="StatusEffectDurationNotify";function Pa(t,e){let n={};return n.objectId=t.u64(),n.effectInstanceId=t.u32(),n.characterId=t.u64(),n.value=t.u32(),n}function va(t,e){t.u64(e.objectId),t.u32(e.effectInstanceId),t.u64(e.characterId),t.u32(e.value)}var Ta="StatusEffectSyncDataNotify";function Ia(t,e){let n={};return n.step=t.u32(),n.unk2_m=t.bool(),n.triggerId=t.u32(),n}function Ea(t,e){t.u32(e.step),t.bool(e.unk2_m),t.u32(e.triggerId)}var xa="TriggerBossBattleStatus";function Na(t,e){let n={};return n.packetResultCode=t.u32(),n.triggerId=t.u32(),n.unk0_m=t.u32(),n.involvedPCs=t.array(t.u16(),()=>t.u64(),40),n}function Da(t,e){t.u32(e.packetResultCode),t.u32(e.triggerId),t.u32(e.unk0_m),t.array(e.involvedPCs,{maxLen:40,lenType:"u16"},n=>{t.u64(n)})}var ga="TriggerFinishNotify";function Ra(t,e){let n={};return n.triggerId=t.u32(),n.triggerSignalType=t.u32(),n.sourceId=t.u64(),n.involvedPCs=t.array(t.u16(),()=>t.u64(),40),n}function La(t,e){t.u32(e.triggerId),t.u32(e.triggerSignalType),t.u64(e.sourceId),t.array(e.involvedPCs,{maxLen:40,lenType:"u16"},n=>{t.u64(n)})}var wa="TriggerStartNotify";function Aa(t,e){let n={};return n.maxHp=T(t,e),n.characterId=t.u64(),n.unk0_m=t.u32(),n.statusEffectDatas=t.array(t.u16(),()=>V(t,e),80),n.position=t.u64(),n.curHp=T(t,e),n}function Ka(t,e){M(t,e.maxHp),t.u64(e.characterId),t.u32(e.unk0_m),t.array(e.statusEffectDatas,{maxLen:80,lenType:"u16"},n=>{Z(t,n)}),t.u64(e.position),M(t,e.curHp)}var Ba="TroopMemberUpdateMinNotify";function Ca(t,e){let n={};return n.identityGauge1=t.u32(),n.identityGauge2=t.u32(),n.identityGauge3=t.u32(),n.playerId=t.u64(),n}function Ma(t,e){t.u32(e.identityGauge1),t.u32(e.identityGauge2),t.u32(e.identityGauge3),t.u64(e.playerId)}var ja="IdentityGaugeChangeNotify";function Oa(t,e){let n={};return n.objectId=t.u64(),n}function Fa(t,e){t.u64(e.objectId)}var qa="ZoneObjectUnpublishNotify";function ru(t,e){let n={};return n.stackCount=t.u8(),n.target=t.u8(),n.id=t.u32(),n}function uu(t,e){t.u8(e.stackCount),t.u8(e.target),t.u32(e.id)}function Wa(t,e){let n={};return n.zoneStatusEffectDataList=t.array(t.u16(),()=>ru(t,e),4),n}function Ua(t,e){t.array(e.zoneStatusEffectDataList,{maxLen:4,lenType:"u16"},n=>{uu(t,n)})}var Va="ZoneStatusEffectAddNotify";function Za(t,e){let n={};return n.statusEffectId=t.u32(),n}function za(t,e){t.u32(e.statusEffectId)}var Ha="ZoneStatusEffectRemoveNotify";function Ga(t,e){let n={};return n.skillLevel=t.u8(),n.caster=t.u64(),n.skillId=t.u32(),n}function Ya(t,e){t.u8(e.skillLevel),t.u64(e.caster),t.u32(e.skillId)}var $a="SkillCastNotify";function Qa(t,e){let n={};return n.objectId=t.u64(),n.stance=t.u8(),n}function Ja(t,e){t.u64(e.objectId),t.u8(e.stance)}var Xa="IdentityStanceChangeNotify";function ya(t,e){let n={};return n.objectId=t.u64(),n.equipItemDataList=t.array(t.u16(),()=>_e(t,e),32),n}function es(t,e){t.u64(e.objectId),t.array(e.equipItemDataList,{maxLen:32,lenType:"u16"},n=>{le(t,n)})}var ts="EquipChangeNotify";function ns(t,e){let n={};return n.objectId=t.u64(),n.equipLifeToolDataList=t.array(t.u16(),()=>_e(t,e),9),n}function os(t,e){t.u64(e.objectId),t.array(e.equipLifeToolDataList,{maxLen:9,lenType:"u16"},n=>{le(t,n)})}var as="EquipLifeToolChangeNotify";function mu(t,e){let n={};return t.bool()&&(n.serialNumber=t.u64(),n.id=t.u32(),n.level=t.u16(),n.slot=t.u16(),n.durability=t.u32(),n.unk1_6_m=t.u32(),n.flag=t.u32(),n.expireTime=W(t),n.lockUpdateTime=W(t)),n}function _u(t,e){t.bool(e.slot!==void 0)&&(t.u64(e.serialNumber),t.u32(e.id),t.u16(e.level),t.u16(e.slot),t.u32(e.durability),t.u32(e.unk1_6_m),t.u32(e.flag),re(t,e.expireTime),re(t,e.lockUpdateTime))}function ss(t,e){let n={};return n.itemDataList=t.array(t.u16(),()=>mu(t,e),80),n.storageType=t.u8(),n}function is(t,e){t.array([1,20].includes(e.storageType)?e.itemDataList:[],{maxLen:80,lenType:"u16"},n=>{_u(t,n)}),t.u8(e.storageType)}var rs="InitItem";function lu(t,e){let n={};return n.npcId=t.u32(),n.isDead=t.bool(),n}function fu(t,e){t.u32(e.npcId),t.bool(e.isDead)}function us(t,e){let n={};return n.raidResult=t.u8(),n.raidId=t.u32(),n.totalTime=t.u64(),n.bossKillDataList=t.array(t.u16(),()=>lu(t,e),3),n.endTick=t.u64(),n.startTick=t.u64(),n}function ms(t,e){t.u8(e.raidResult),t.u32(e.raidId),t.u64(e.totalTime),t.array(e.bossKillDataList,{maxLen:3,lenType:"u16"},n=>{fu(t,n)}),t.u64(e.endTick),t.u64(e.startTick)}var _s="RaidBegin";function ls(t,e){let n={};return n.zoneInstId=t.u64(),n.zoneId=t.u32(),n.loadComplete=t.bool(),n.completeMembers=t.array(t.u16(),()=>t.u64(),40),n.totalMembers=t.array(t.u16(),()=>t.u64(),40),n.firstPCEnterTick=t.u64(),n.zoneLevel=t.u8(),n}function fs(t,e){t.u64(e.zoneInstId),t.u32(e.zoneId),t.bool(e.loadComplete),t.array(e.completeMembers,{maxLen:40,lenType:"u16"},n=>{t.u64(n)}),t.array(e.totalMembers,{maxLen:40,lenType:"u16"},n=>{t.u64(n)}),t.u64(e.firstPCEnterTick),t.u8(e.zoneLevel)}var cs="ZoneMemberLoadStatusNotify";function cu(t,e){let n={};return n.position=N(t),n.objectId=t.u64(),n.ownerId=t.u64(),n.skillId=t.u32(),n.skillEffect=t.u32(),n}function du(t,e){F(t,e.position),t.u64(e.objectId),t.u64(e.ownerId),t.u32(e.skillId),t.u32(e.skillEffect)}function ds(t,e){let n={};return n.trapData=cu(t,e),n}function ps(t,e){du(t,e.trapData)}var hs="NewTrap";function Ss(t,e){let n={};return n.skillId=t.u32(),n.caster=t.u64(),n.newDirectionYaw=K(t),n.cancelReason=t.u8(),n.newPosition=N(t),n}function ks(t,e){t.u32(e.skillId),t.u64(e.caster),X(t,e.newDirectionYaw),t.u8(e.cancelReason),F(t,e.newPosition)}var bs="SkillCancelNotify";function Ps(t,e){let n={};return n.players=t.array(t.u8(),()=>{let o={};return o.name=t.string(20),o.stats=t.array(t.u8(),()=>{let s={};return s.id=t.u8(),s.value=t.u32(),s},100),e>=4&&(o.elixirs=t.array(t.u8(),()=>{let s={};return s.slot=t.u8(),s.entries=t.array(t.u8(),()=>{let i={};return i.level=t.u8(),i.id=t.u32(),i}),s},32)),e>=5&&(o.gems=t.array(t.u8(),()=>{let s={};s.id=t.u32(),s.skillId=t.u32(),s.type=t.u8(),s.value=t.u16()})),o},24),n}function vs(t,e){t.array(e.players,{maxLen:24,lenType:"u8"},n=>{t.string(n.name,20),t.array(n.stats,{maxLen:100,lenType:"u8"},o=>{t.u8(o.id),t.u32(o.value)}),t.array(n.elixirs,{maxLen:32,lenType:"u8"},o=>{t.u8(o.slot),t.array(o.entries,{maxLen:5,lenType:"u8"},s=>{t.u8(s.level),t.u32(s.id)})}),t.array(n.gems,{maxLen:20,lenType:"u8"},o=>{t.u32(o.id),t.u32(o.skillId),t.u8(o.type),t.u16(o.value)})})}var Ts="APP_StatApi";var Xt=new Map([[0,[Pn,kn,bn]],[1,[In,vn,Tn]],[2,[Nn,En,xn]],[4,[Rn,Dn,gn]],[5,[An,Ln,wn]],[6,[Cn,Kn,Bn]],[7,[On,Mn,jn]],[8,[Wn,Fn,qn]],[9,[zn,Vn,Zn]],[10,[Yn,Hn,Gn]],[11,[Qn,$n,we]],[12,[eo,Xn,yn]],[13,[oo,to,no]],[14,[ro,so,io]],[15,[fo,_o,lo]],[16,[ho,co,po]],[17,[bo,So,ko]],[18,[To,Po,vo]],[19,[xo,Io,Eo]],[20,[go,No,Do]],[21,[wo,Ro,Lo]],[22,[Bo,Ao,Ko]],[23,[jo,Co,Mo]],[24,[qo,Oo,Fo]],[25,[Vo,Wo,Uo]],[26,[Ho,Zo,zo]],[27,[$o,Go,Yo]],[28,[Xo,Qo,Jo]],[29,[ta,yo,ea]],[30,[aa,na,oa]],[31,[ra,sa,ia]],[32,[_a,ua,ma]],[34,[ca,la,fa]],[35,[ha,da,pa]],[36,[ba,Sa,ka]],[37,[Ta,Pa,va]],[38,[xa,Ia,Ea]],[39,[ga,Na,Da]],[40,[wa,Ra,La]],[41,[Ba,Aa,Ka]],[42,[ja,Ca,Ma]],[43,[qa,Oa,Fa]],[44,[Va,Wa,Ua]],[45,[Ha,Za,za]],[46,[$a,Ga,Ya]],[47,[Xa,Qa,Ja]],[48,[ts,ya,es]],[49,[as,ns,os]],[50,[rs,ss,is]],[52,[_s,us,ms]],[51,[cs,ls,fs]],[53,[hs,ds,ps]],[54,[bs,Ss,ks]],[6e4,[Ts,Ps,vs]]]);var ee,se,Ke,Es=class{constructor(e,n,o){J(this,ee,void 0);J(this,se,void 0);J(this,Ke,void 0);$(this,"ip");$(this,"zoneSyncStatus",0);$(this,"cache",new Map);o&&ne(this,ee,o),ne(this,se,e),ne(this,Ke,n)}syncData(){let e=[];g(this,se).entities.forEach(n=>{n.entityType===1&&e.push(n)}),this.getPlayersData(e)}getPlayersData(e,n=0){if(n>24){e.forEach(s=>{let i=this.cache.get(s.name);i&&i.status===1?i.status=0:i||this.cache.set(s.name,{hash:"",status:0,info:{name:s.name,stats:[],elixirs:[],gems:[]}})});return}if(!this.isCurrentZoneValid()){e.forEach(s=>{let i=this.cache.get(s.name);i&&i.status===1&&this.cache.delete(s.name)});return}if(!g(this,ee)||!this.ip)return;let o={};e.forEach(s=>{let i=this.getHash(s),a=this.cache.get(s.name);if(!i){a&&a.status===1&&this.cache.delete(s.name);return}a&&(a.status===0||n===0&&a.status===1||a.status===2&&a.hash===i)||(a?(a.hash=i,a.status=1):a={hash:i,status:1,info:{name:s.name,stats:[],elixirs:[],gems:[]}},this.cache.set(s.name,a),o[s.name]=i)}),Object.keys(o).length!==0&&hu.default.get(`${Es.baseUrl}/req2`,{params:{ip:this.ip,ci:g(this,Ke),...o}}).then(s=>{if(s.status===200&&g(this,ee))try{let i=s.data,a=Xt.get(6e4);if(a){let[m,f,l]=a,k={players:i};if(e=e.filter(h=>!i.find(v=>v.name===h.name)),e.length>0&&setTimeout(()=>{e=e.map(h=>g(this,se).getEntityByName(h.name)).filter(h=>h!==void 0&&h.entityType===1),this.getPlayersData(e,n+1)},1e4),k.players.length>0){let h=new oe(k,6e4,l);g(this,ee).emit(m,h),g(this,ee).emit("*",m,h),g(this,ee).appendLog(h)}}}catch{setTimeout(()=>{e=e.map(a=>g(this,se).getEntityByName(a.name)).filter(a=>a!==void 0&&a.entityType===1),this.getPlayersData(e,n+5)},1e4)}}).catch(s=>{setTimeout(()=>{e=e.map(i=>g(this,se).getEntityByName(i.name)).filter(i=>i!==void 0&&i.entityType===1),this.getPlayersData(e,n+5)},1e4)})}getHash(e){if(!e.items.equipList||e.characterId===0n||!e.class||e.name==="You")return;let n=new Array(32).fill(0);e.items.equipList?.forEach(s=>{n[s.slot]=s.id});let o=`${e.name}${e.class}${e.characterId}${n.join("")}`;return(0,pu.createHash)("md5").update(o).digest("hex")}updatePlayerStats(e){e.forEach(n=>{let o=this.cache.get(n.name);o?(o.info=n,o.status=2):this.cache.set(n.name,{hash:"",status:2,info:n})})}getStats(e){if(!this.isCurrentZoneValid())return;let n=this.cache.get(e);if(n&&n.status===2)return n.info.stats}isCurrentZoneValid(){return this.zoneSyncStatus!==0&&(this.zoneSyncStatus&10)===0}},Ae=Es;ee=new WeakMap,se=new WeakMap,Ke=new WeakMap,$(Ae,"baseUrl","https://la.herysia.com");var Em={isLive:!0,dontResetOnZoneChange:!1,resetAfterPhaseTransition:!1,splitOnPhaseTransition:!1},yt=class extends Su.TypedEmitter{#e;encounters;#o;#i;#a;#n;options;resetTimer;phaseTransitionResetRequest;phaseTransitionResetRequestTime;#t;constructor(e,n,o,s,i){super(),this.#o=e,this.#i=n,this.#a=o,this.#n=s,this.options={...Em,...i},this.resetTimer=null,this.phaseTransitionResetRequest=!1,this.phaseTransitionResetRequestTime=0,this.#t=new Map,this.encounters=[],this.#e={startedOn:0,lastCombatPacket:0,fightStartedOn:0,localPlayer:this.#o.localPlayer.name,currentBoss:void 0,killState:0,zoneLevel:De[0],entities:new Map,damageStatistics:{totalDamageDealt:0,topDamageDealt:0,totalDamageTaken:0,topDamageTaken:0,totalHealingDone:0,topHealingDone:0,totalShieldDone:0,topShieldDone:0,debuffs:new Map,buffs:new Map,topShieldGotten:0,totalEffectiveShieldingDone:0,topEffectiveShieldingDone:0,topEffectiveShieldingUsed:0,effectiveShieldingBuffs:new Map,appliedShieldingBuffs:new Map}}}onCounterAttack(e,n){let o=this.updateEntity(e,{},n);o.hits.counter+=1}onInitEnv(e,n){this.options.isLive?(this.#e.entities.forEach((o,s,i)=>{o.hits.total===0&&i.delete(s)}),this.options.dontResetOnZoneChange===!1&&this.resetTimer===null&&(this.resetTimer=setTimeout(()=>{this.resetState(+n+6e3)},6e3),this.emit("message","new-zone"))):(this.splitEncounter(n),this.emit("message","new-zone"))}splitEncounter(e){if(this.#e.fightStartedOn!==0&&(this.#e.damageStatistics.totalDamageDealt!==0||this.#e.damageStatistics.totalDamageTaken!==0)){let n=structuredClone(this.#e);n.entities.forEach(o=>{o.isPlayer&&(o.statApiValid=this.#a.isCurrentZoneValid()&&this.#a.cache.get(o.name)?.status===2)}),n.localPlayer=this.#o.localPlayer.name,this.applyBreakdowns(n.entities),this.encounters.push(n)}this.resetState(+e)}getBossIfStillExist(){if(this.#e.currentBoss?.id){let e=BigInt(`0x0${this.#e.currentBoss?.id}`);return this.#o.entities.has(e)?this.#e.currentBoss:void 0}}resetState(e){this.cancelReset(),this.resetBreakdowns(),this.#e={startedOn:+e,lastCombatPacket:+e,fightStartedOn:0,localPlayer:this.#o.localPlayer.name,currentBoss:this.getBossIfStillExist(),entities:new Map,killState:0,zoneLevel:this.#e.zoneLevel,damageStatistics:{totalDamageDealt:0,topDamageDealt:0,totalDamageTaken:0,topDamageTaken:0,totalHealingDone:0,topHealingDone:0,totalShieldDone:0,topShieldDone:0,debuffs:new Map,buffs:new Map,appliedShieldingBuffs:new Map,effectiveShieldingBuffs:new Map,topEffectiveShieldingDone:0,topEffectiveShieldingUsed:0,topShieldGotten:0,totalEffectiveShieldingDone:0}},this.emit("reset-state",this.#e)}cancelReset(){this.resetTimer&&clearTimeout(this.resetTimer),this.resetTimer=null}onPhaseTransition(e,n){this.options.isLive&&(this.emit("message",`phase-transition-${e}`),this.options.resetAfterPhaseTransition&&(this.phaseTransitionResetRequest=!0,this.phaseTransitionResetRequestTime=+n)),!this.options.isLive&&this.options.splitOnPhaseTransition&&this.splitEncounter(n)}updateOptions(e){this.options={...this.options,...e}}onDeath(e,n){let o=this.#e.entities.get(e.name),s=0;o?o.isDead?s=o.deaths:s=o.deaths+1:s=1,this.updateEntity(e,{isDead:!0,deathTime:+n,deaths:s},n)}onDamage(e,n,o,s,i,a){if((s.modifier&15)===11&&s.skillId===0&&s.skillEffectId===0)return;this.phaseTransitionResetRequest&&this.phaseTransitionResetRequestTime>0&&this.phaseTransitionResetRequestTime<+a-8e3&&(this.resetState(+a),this.phaseTransitionResetRequest=!1);let[m,f]=this.#i.getStatusEffects(e,o,this.#o.localPlayer.characterId,a);if(this.#n.isBattleItem(s.skillEffectId,"attack")&&n&&n.entityType===5){let C=n;s.skillEffectId=C.skillEffectId}let l=this.updateEntity(e,{},a),k=this.updateEntity(o,{currentHp:s.targetCurHp,maxHp:s.targetMaxHp},a);if(!l||!k)return;!k.isPlayer&&s.targetCurHp<0&&(s.damage=s.damage+s.targetCurHp);let h=s.skillId;s.skillId===0&&s.skillEffectId!==0&&(h=s.skillEffectId);let v=l.skills.get(h);v||(v={...this.createEntitySkill(),id:h,...this.getSkillNameIcon(s.skillId,s.skillEffectId)},l.skills.set(h,v));let G=s.modifier&15,w=(s.modifier>>4&7)-1,B=(G&9)!==0,Q=new Set,j=new Set;m.forEach(([C])=>{Q.add(C)}),f.forEach(([C])=>{j.add(C)}),v.damageInfo.damageDealt+=s.damage,s.damage>v.maxDamage&&(v.maxDamage=s.damage),l.hits.total+=1,v.hits.total+=1,l.damageInfo.damageDealt+=s.damage,k.damageTaken+=s.damage;let Kt=B?1:0;l.hits.crit+=Kt,v.hits.crit+=Kt;let Bt=!1,Ct=!1,Mt=this.#n.getSkillEffectDirectionalMask(s.skillEffectId)-1;if(Mt===0||Mt===2){Ct=w===0;let C=Ct?1:0;l.hits.backAttack+=C,l.hits.totalBackAttack+=1,v.hits.backAttack+=C,v.hits.totalBackAttack+=1}if(Mt===1||Mt===2){Bt=w===1;let C=Bt?1:0;l.hits.frontAttack+=C,l.hits.totalFrontAttack+=1,v.hits.frontAttack+=C,v.hits.totalFrontAttack+=1}if(l.isPlayer){this.#e.damageStatistics.totalDamageDealt+=s.damage,this.#e.damageStatistics.topDamageDealt=Math.max(this.#e.damageStatistics.topDamageDealt,l.damageInfo.damageDealt);let C=!1,ce=!1;Q.forEach(_=>{if(!this.#e.damageStatistics.buffs.has(_)){let D=this.#n.getStatusEffectHeaderData(_);D&&this.#e.damageStatistics.buffs.set(_,D)}let A=this.#e.damageStatistics.buffs.get(_);A&&!C&&(C=(A.buffcategory==="classskill"||A.buffcategory==="identity"||A.buffcategory==="ability")&&A.source.skill!==void 0&&A.target===1&&this.#n.isSupportClassId(A.source.skill.classid));let y=v.damageDealtBuffedBy.get(_)??0;v.damageDealtBuffedBy.set(_,y+s.damage);let de=l.damageDealtBuffedBy.get(_)??0;l.damageDealtBuffedBy.set(_,de+s.damage);let xe=l.hits.hitsBuffedBy.get(_)??0;l.hits.hitsBuffedBy.set(_,xe+1);let R=v.hits.hitsBuffedBy.get(_)??0;v.hits.hitsBuffedBy.set(_,R+1)}),j.forEach(_=>{if(!this.#e.damageStatistics.debuffs.has(_)){let D=this.#n.getStatusEffectHeaderData(_);D&&this.#e.damageStatistics.debuffs.set(_,D)}let A=this.#e.damageStatistics.debuffs.get(_);A&&!ce&&(ce=(A.buffcategory==="classskill"||A.buffcategory==="identity"||A.buffcategory==="ability")&&A.source.skill!==void 0&&A.target===1&&this.#n.isSupportClassId(A.source.skill.classid));let y=v.damageDealtDebuffedBy.get(_)??0;v.damageDealtDebuffedBy.set(_,y+s.damage);let de=l.damageDealtDebuffedBy.get(_)??0;l.damageDealtDebuffedBy.set(_,de+s.damage);let xe=l.hits.hitsDebuffedBy.get(_)??0;l.hits.hitsDebuffedBy.set(_,xe+1);let R=v.hits.hitsDebuffedBy.get(_)??0;v.hits.hitsDebuffedBy.set(_,R+1)});let Br=ce?1:0,Cr=C?1:0;if(v.damageInfo.damageDealtBuffedBySupport+=C?s.damage:0,v.damageInfo.damageDealtDebuffedBySupport+=ce?s.damage:0,l.damageInfo.damageDealtBuffedBySupport+=C?s.damage:0,l.damageInfo.damageDealtDebuffedBySupport+=ce?s.damage:0,l.hits.hitsBuffedBySupport+=Cr,l.hits.hitsDebuffedBySupport+=Br,v.hits.hitsBuffedBySupport+=Cr,v.hits.hitsDebuffedBySupport+=Br,s.damage>0&&l.isPlayer){let _={multDmg:{sumRate:0,totalRate:1,values:Array()},atkPowSubRate2:{selfSumRate:0,sumRate:0,values:Array()},atkPowSubRate1:{sumRate:0,totalRate:1,values:Array()},skillDamRate:{selfSumRate:0,sumRate:0,values:Array()},atkPowAmplify:{values:Array()},crit:{selfSumRate:0,sumRate:0,values:Array()},critDmgRate:2};if(m.forEach(([R,D,L])=>{let E=this.#o.entities.get(D);if(!E)return;let p=this.getBuffAfterTripods(this.#n.skillBuff.get(R),E,s);if(p){if(p.type==="skill_damage_amplify"&&p.statuseffectvalues&&E.entityType===1&&D!==e.entityId){let P=p.statuseffectvalues[0]??0,S=p.statuseffectvalues[4]??0;if((P===0||P===s.skillId)&&(S===0||S===s.skillEffectId)){let I=p.statuseffectvalues[1]??0;if(I!==0){let x=I/1e4*L;_.multDmg.values.push({casterEntity:E,rate:x}),_.multDmg.sumRate+=x,_.multDmg.totalRate*=1+x}}}else if(p.type==="attack_power_amplify"&&p.statuseffectvalues&&E.entityType===1&&D!==e.entityId){let P=p.statuseffectvalues[0]??0;if(P!==0){let S=P/1e4*L,I=this.#a.getStats(E.name)?.find(q=>q.id===4)?.value,x=this.#a.getStats(e.name)?.find(q=>q.id===4)?.value;I&&x&&(S*=I/x),_.atkPowAmplify.values.push({casterEntity:E,rate:S})}}p.passiveoption.forEach(P=>{if(ie[P.type]===2){if(P.keystat==="attack_power_sub_rate_2"){let S=P.value;if(S!==0){let I=S/1e4*L;E.entityType===1&&D!==e.entityId?(_.atkPowSubRate2.values.push({casterEntity:E,rate:I}),_.atkPowSubRate2.sumRate+=I):_.atkPowSubRate2.selfSumRate+=I}}else if(P.keystat==="attack_power_sub_rate_1"){let S=P.value;if(S!==0){let I=S/1e4*L;E.entityType===1&&D!==e.entityId&&(_.atkPowSubRate1.values.push({casterEntity:E,rate:I}),_.atkPowSubRate1.sumRate+=I,_.atkPowSubRate1.totalRate*=1+I)}}else if(P.keystat==="skill_damage_rate"){let S=P.value;if(S!==0){let I=S/1e4*L;E.entityType===1&&D!==e.entityId?(_.skillDamRate.values.push({casterEntity:E,rate:I}),_.skillDamRate.sumRate+=I):_.skillDamRate.selfSumRate+=I}}}if(P.keystat==="critical_hit_rate"){let S=P.value;if(S!==0){let I=S/1e4*L;E.entityType===1&&D!==e.entityId?(_.crit.values.push({casterEntity:E,rate:I}),_.crit.sumRate+=I):_.crit.selfSumRate+=I}}if(E.entityType===1&&D!==e.entityId)if(P.keystat==="skill_damage_sub_rate_2"){let S=P.value;if(S!==0){let I=S/1e4*L,x=this.#a.getStats(E.name)?.find(q=>q.id===1)?.value??0;switch(E.class){case 204:I*=1+x/.0699*.35/1e4;break;case 105:I*=1+x/.0699*.63/1e4;break;case 602:I*=1+x/.0699*.38/1e4;break;default:break}_.multDmg.values.push({casterEntity:E,rate:I}),_.multDmg.sumRate+=I,_.multDmg.totalRate*=1+I}}else P.keystat==="critical_dam_rate"&&p.category==="buff"&&(_.critDmgRate+=P.value/1e4*L);else if(ie[P.type]===4){let S=this.#n.combatEffect.get(P.keyindex);_.critDmgRate+=L*this.getCritMultiplierFromCombatEffect(S,{self:e,target:o,caster:E,skill:this.#n.skill.get(h),hitOption:w,targetCount:i})}})}}),f.forEach(([R,D,L])=>{let E=this.#o.entities.get(D);if(!E)return;let p=this.getBuffAfterTripods(this.#n.skillBuff.get(R),E,s);if(p){if(p.type==="instant_stat_amplify"&&p.statuseffectvalues){let P=p.statuseffectvalues[0]??0;if(P!==0){let S=P/1e4*L;E.entityType===1&&D!==e.entityId?(_.crit.values.push({casterEntity:E,rate:S}),_.crit.sumRate+=S):_.crit.selfSumRate+=S}}if(!(E.entityType!==1||D===e.entityId)){if(p.type==="instant_stat_amplify"&&p.statuseffectvalues){let P=p.statuseffectvalues[0]??0;if(s.damageType===0){let S=p.statuseffectvalues[2]??0;if(S!==0){let x=-(S/1e4)*L*.5;_.multDmg.values.push({casterEntity:E,rate:x}),_.multDmg.sumRate+=x,_.multDmg.totalRate*=1+x}let I=p.statuseffectvalues[7]??0;if(I!==0){let x=I/1e4*L;_.multDmg.values.push({casterEntity:E,rate:x}),_.multDmg.sumRate+=x,_.multDmg.totalRate*=1+x}if(B){let x=p.statuseffectvalues[9]??0;if(x!==0){let q=x/1e4*L;_.multDmg.values.push({casterEntity:E,rate:q}),_.multDmg.sumRate+=q,_.multDmg.totalRate*=1+q}}}else if(s.damageType===1){let S=p.statuseffectvalues[3]??0;if(S!==0){let x=-(S/1e4)*L*.5;_.multDmg.values.push({casterEntity:E,rate:x}),_.multDmg.sumRate+=x,_.multDmg.totalRate*=1+x}let I=p.statuseffectvalues[8]??0;if(I!==0){let x=I/1e4*L;_.multDmg.values.push({casterEntity:E,rate:x}),_.multDmg.sumRate+=x,_.multDmg.totalRate*=1+x}if(B){let x=p.statuseffectvalues[10]??0;if(x!==0){let q=x/1e4*L;_.multDmg.values.push({casterEntity:E,rate:q}),_.multDmg.sumRate+=q,_.multDmg.totalRate*=1+q}}}}if(p.type==="skill_damage_amplify"&&p.statuseffectvalues){let P=p.statuseffectvalues[0]??0,S=p.statuseffectvalues[4]??0;if((P===0||P===s.skillId)&&(S===0||S===s.skillEffectId)){let I=p.statuseffectvalues[1]??0;if(I!==0){let x=I/1e4*L;_.multDmg.values.push({casterEntity:E,rate:x}),_.multDmg.sumRate+=x,_.multDmg.totalRate*=1+x}}}if(p.type==="directional_attack_amplify"&&p.statuseffectvalues){if(Bt){let P=p.statuseffectvalues[0]??0;if(P!==0){let S=P/100*L;_.multDmg.values.push({casterEntity:E,rate:S}),_.multDmg.sumRate+=S,_.multDmg.totalRate*=1+S}}if(Ct){let P=p.statuseffectvalues[4]??0;if(P!==0){let S=P/100*L;_.multDmg.values.push({casterEntity:E,rate:S}),_.multDmg.sumRate+=S,_.multDmg.totalRate*=1+S}}}}}}),_.crit.values.length>0){let R=this.#n.skill.get(s.skillId);e.itemSet?.forEach(D=>{if(ie[D.type]===2&&Se[D.keystat]===76)_.critDmgRate+=D.value/1e4;else if(ie[D.type]===4){let L=this.#n.combatEffect.get(D.keyindex);_.critDmgRate+=this.getCritMultiplierFromCombatEffect(L,{self:e,target:o,caster:e,skill:R,hitOption:w,targetCount:i})}e.skills.get(s.skillId)?.tripods.forEach(L=>{let E=new Map;L.options.forEach(p=>{let P=Ft[p.type];if(P===45){if((p.params[0]??0)===0||s.skillEffectId===(p.params[0]??0)){let S=p.params[1];if(S){let I=this.#n.combatEffect.get(S);I&&E.set(I.id,I)}}}else if(P===46)E.delete(p.params[0]??0);else if(P===104){if((p.params[0]??0)===0||s.skillEffectId===(p.params[0]??0)){let S=E.get(p.params[1]??0);if(S){let I=structuredClone(S);E.set(S.id,I),I.effects.forEach(x=>{x.actions.forEach(q=>{for(let pe=0;pe<p.params.length-2;pe++)Ot[p.paramtype]===1?q.args[pe]*=1+(p.params[pe+2]??0)/100:q.args[pe]+=p.params[pe+2]??0})})}}}else P===29?((p.params[0]??0)===0||s.skillEffectId===(p.params[0]??0))&&(_.critDmgRate+=(p.params[1]??0)/1e4):P===30&&((p.params[0]??0)===0||s.skillEffectId===(p.params[0]??0))&&(_.crit.selfSumRate+=(p.params[1]??0)/1e4)}),E.forEach(p=>{_.critDmgRate+=this.getCritMultiplierFromCombatEffect(p,{self:e,target:o,caster:e,skill:R,hitOption:w,targetCount:i})})})})}if(_.skillDamRate.values.length>0){let R=this.#a.getStats(e.name)?.find(D=>D.id===5)?.value;R&&(_.skillDamRate.selfSumRate+=R/1e4)}let A=0;if(_.crit.values.length>0){_.crit.selfSumRate+=(this.#a.getStats(e.name)?.find(D=>D.id===0)?.value??0)/.2794/1e4;let R=Math.min(Math.max(0,1-_.crit.selfSumRate),_.crit.sumRate);A=(R*_.critDmgRate-R)/(_.crit.selfSumRate*_.critDmgRate-_.crit.selfSumRate+1)}let y=_.atkPowAmplify.values.length<=0?{rate:0}:_.atkPowAmplify.values.reduce((R,D)=>R.rate>D.rate?R:D),de=(1+A)*(1+_.atkPowSubRate2.sumRate/(1+_.atkPowSubRate2.selfSumRate))*(1+_.skillDamRate.sumRate/(1+_.skillDamRate.selfSumRate))*(1+y.rate)*_.multDmg.totalRate*_.atkPowSubRate1.totalRate-1,xe=A+_.atkPowSubRate2.sumRate/(1+_.atkPowSubRate2.selfSumRate)+_.skillDamRate.sumRate/(1+_.skillDamRate.selfSumRate)+y.rate+(_.multDmg.totalRate-1)+(_.atkPowSubRate1.totalRate-1);{let R=de*s.damage/(xe*(1+de)),D=A*R/_.crit.sumRate;_.crit.values.forEach(p=>{let P=p.rate*D,S=this.#e.entities.get(p.casterEntity.name);this.applyRdps(l,S,v,P)}),_.atkPowSubRate2.values.forEach(p=>{let P=p.rate/(1+_.atkPowSubRate2.selfSumRate)*R,S=this.#e.entities.get(p.casterEntity.name);this.applyRdps(l,S,v,P)}),_.skillDamRate.values.forEach(p=>{let P=p.rate/(1+_.skillDamRate.selfSumRate)*R,S=this.#e.entities.get(p.casterEntity.name);this.applyRdps(l,S,v,P)});let L=(_.multDmg.totalRate-1)*R/_.multDmg.sumRate;_.multDmg.values.forEach(p=>{let P=p.rate*L,S=this.#e.entities.get(p.casterEntity.name);this.applyRdps(l,S,v,P)});let E=(_.atkPowSubRate1.totalRate-1)*R/_.atkPowSubRate1.sumRate;if(_.atkPowSubRate1.values.forEach(p=>{let P=p.rate*E,S=this.#e.entities.get(p.casterEntity.name);this.applyRdps(l,S,v,P)}),y.rate>0){let p=y.rate*R,P=this.#e.entities.get(y.casterEntity?.name);this.applyRdps(l,P,v,p)}}}let b={timestamp:+a,damage:s.damage,targetEntity:k.id,isCrit:B,isBackAttack:Ct,isFrontAttack:Bt,isBuffedBySupport:C,isDebuffedBySupport:ce,buffedBy:[...Q],debuffedBy:[...j]},Yu=BigInt("0x"+l.id);this.addBreakdown(Yu,h,b)}k.isPlayer&&(this.#e.damageStatistics.totalDamageTaken+=s.damage,this.#e.damageStatistics.topDamageTaken=Math.max(this.#e.damageStatistics.topDamageTaken,k.damageTaken)),k.isBoss&&(this.#e.currentBoss=k),this.#e.fightStartedOn===0&&(this.#e.fightStartedOn=+a),this.#e.lastCombatPacket=+a}getBuffAfterTripods(e,n,o){if(!e||n.entityType!==1)return e;let s=structuredClone(e);return n.skills.get(o.skillId)?.tripods.forEach(i=>{i.options.forEach(a=>{let m=Ft[a.type];if(m===19){if(((a.params[0]??0)===0||o.skillEffectId===(a.params[0]??0))&&s.id===(a.params[1]??0)){let f=new Map;for(let l=2;l<a.params.length;l+=2)a.params[l]&&a.params[l+1]&&f.set(a.params[l]??0,a.params[l+1]??0);s.passiveoption.forEach(l=>{let k=f.get(Se[l.keystat]);ie[l.type]===2&&k&&(Ot[a.paramtype]===0?l.value+=k:l.value*=1+k/100)})}}else if(m===42){if(((a.params[0]??0)===0||o.skillEffectId===(a.params[0]??0))&&s.id===(a.params[1]??0)){let f=Se[a.params[2]??0],l=a.params[3]??0;f&&l!==void 0&&s.passiveoption.push({type:"stat",keystat:f,keyindex:0,value:l})}}else if(m===21&&s.statuseffectvalues&&((a.params[0]??0)===0||o.skillEffectId===(a.params[0]??0))&&s.id===(a.params[1]??0))if((a.params[2]??0)===0)s.statuseffectvalues=a.params.slice(3);else{let f=[];for(let l=0;l<Math.max(s.statuseffectvalues.length,a.params.length-3);l++)a.params[l+3]&&f.push((s.statuseffectvalues[l]??0)*(1+(a.params[l+3]??0)/100));s.statuseffectvalues=f}})}),s}getCritMultiplierFromCombatEffect(e,n){if(!e)return 0;let o=0;return e.effects.filter(s=>s.actions.find(i=>jt[i.type]===4)).forEach(s=>{this.#n.isCombatEffectConditionsValid({effect:s,...n})&&s.actions.filter(i=>jt[i.type]===4).forEach(i=>{o+=(i.args[0]??0)/100})}),o}applyRdps(e,n,o,s){n&&(n.damageInfo.rdpsDamageGiven+=s),n&&this.#n.isSupportClassId(n.classId)&&(e.damageInfo.rdpsDamageReceivedSupp+=s,o.damageInfo.rdpsDamageReceivedSupp+=s),e.damageInfo.rdpsDamageReceived+=s,o.damageInfo.rdpsDamageReceived+=s}onStartSkill(e,n,o){let s=this.updateEntity(e,{isDead:!1},o);if(s){s.hits.casts+=1;let i=s.skills.get(n);i||(i={...this.createEntitySkill(),id:n,...this.getSkillNameIcon(n,0)},s.skills.set(n,i)),i.hits.casts+=1}}onShieldUsed(e,n,o,s){if(s<0&&console.error("Shield change values was negative, shield ammount increased"),e.entityType===1&&n.entityType===1){if(!this.#e.damageStatistics.effectiveShieldingBuffs.has(o)){let k=this.#n.getStatusEffectHeaderData(o);k&&this.#e.damageStatistics.effectiveShieldingBuffs.set(o,k)}let i=new Date,a=this.updateEntity(e,{},i),m=this.updateEntity(n,{},i);a.damagePreventedByShield+=s;let f=a.damagePreventedByShieldBy.get(o)??0;a.damagePreventedByShieldBy.set(o,f+s),this.#e.damageStatistics.topEffectiveShieldingUsed=Math.max(a.damagePreventedByShield,this.#e.damageStatistics.topEffectiveShieldingUsed),m.damagePreventedWithShieldOnOthers+=s;let l=m.damagePreventedWithShieldOnOthersBy.get(o)??0;m.damagePreventedWithShieldOnOthersBy.set(o,l+s),this.#e.damageStatistics.topEffectiveShieldingDone=Math.max(m.damagePreventedWithShieldOnOthers,this.#e.damageStatistics.topEffectiveShieldingDone),this.#e.damageStatistics.totalEffectiveShieldingDone+=s}}onShieldApplied(e,n,o,s){let i=new Date,a=this.updateEntity(e,{},i),m=this.updateEntity(n,{},i);if(m.isPlayer&&a.isPlayer){if(!this.#e.damageStatistics.appliedShieldingBuffs.has(o)){let k=this.#n.getStatusEffectHeaderData(o);k&&this.#e.damageStatistics.appliedShieldingBuffs.set(o,k)}a.shieldReceived+=s,m.shieldDone+=s;let f=m.shieldDoneBy.get(o)??0;m.shieldDoneBy.set(o,f+s);let l=a.shieldReceivedBy.get(o)??0;a.shieldReceivedBy.set(o,l+s),this.#e.damageStatistics.topShieldDone=Math.max(m.shieldDone,this.#e.damageStatistics.topShieldDone),this.#e.damageStatistics.topShieldGotten=Math.max(a.shieldReceived,this.#e.damageStatistics.topShieldGotten),this.#e.damageStatistics.totalShieldDone+=s}}getSkillNameIcon(e,n){if(e===0&&n===0)return{name:"Bleed",icon:"buff_168.png"};if(e===0){let o=this.#n.skillEffect.get(n);if(o&&o.itemname)return{name:o.itemname,icon:o.icon??""};if(o){if(o.sourceskill){let s=this.#n.skill.get(o.sourceskill);if(s)return{name:s.name,icon:s.icon}}else{let s=this.#n.skill.get(Math.floor(n/10));if(s)return{name:s.name,icon:s.icon}}return{name:o.comment}}else return{name:this.#n.getSkillName(e)}}else{let o=this.#n.skill.get(e);return!o&&(o=this.#n.skill.get(e-e%10),!o)?{name:this.#n.getSkillName(e),icon:""}:o.summonsourceskill?(o=this.#n.skill.get(o.summonsourceskill),o?{name:o.name+" (Summon)",icon:o.icon}:{name:this.#n.getSkillName(e),icon:""}):o.sourceskill?(o=this.#n.skill.get(o.sourceskill),o?{name:o.name,icon:o.icon}:{name:this.#n.getSkillName(e),icon:""}):{name:o.name,icon:o.icon}}}updateEntity(e,n,o){let s={lastUpdate:+o},i=this.#e.entities.get(e.name),a={};if(!i||e.entityType===1&&i.isPlayer!==!0){if(e.entityType===1){let m=e;a={classId:m.class,gearScore:m.gearLevel,isPlayer:!0}}else if(e.entityType===2||e.entityType===3){let m=e;a={npcId:m.typeId,isBoss:m.isBoss}}else if(e.entityType===4){let m=e;a={npcId:m.typeId,isBoss:m.isBoss,isEsther:!0,icon:m.icon}}}return i?Object.assign(i,n,s,a):(i={...this.createEntity(),...n,...s,...a,name:e.name,id:e.entityId.toString(16)},this.#e.entities.set(e.name,i)),i}updateOrCreateEntity(e,n,o){if(!(!n.name||!n.id)){for(let[s,i]of this.#e.entities)if(n.id===i.id){this.#e.entities.delete(s),this.updateEntity(e,{...i,...n},o);return}this.updateEntity(e,n,o)}}createEntitySkill(){return{id:0,name:"",icon:"",damageInfo:{damageDealt:0,rdpsDamageReceived:0,rdpsDamageReceivedSupp:0,rdpsDamageGiven:0,damageDealtDebuffedBySupport:0,damageDealtBuffedBySupport:0},maxDamage:0,hits:{casts:0,total:0,crit:0,backAttack:0,totalBackAttack:0,frontAttack:0,totalFrontAttack:0,counter:0,hitsDebuffedBySupport:0,hitsBuffedBySupport:0,hitsBuffedBy:new Map,hitsDebuffedBy:new Map},breakdown:[],damageDealtDebuffedBy:new Map,damageDealtBuffedBy:new Map}}createEntity(){return{lastUpdate:0,id:"",npcId:0,name:"",classId:0,isBoss:!1,isPlayer:!1,isDead:!1,deaths:0,deathTime:0,gearScore:0,currentHp:0,maxHp:0,damageInfo:{damageDealt:0,rdpsDamageReceived:0,rdpsDamageReceivedSupp:0,rdpsDamageGiven:0,damageDealtDebuffedBySupport:0,damageDealtBuffedBySupport:0},healingDone:0,shieldDone:0,damageTaken:0,skills:new Map,hits:{casts:0,total:0,crit:0,backAttack:0,totalBackAttack:0,frontAttack:0,totalFrontAttack:0,counter:0,hitsDebuffedBySupport:0,hitsBuffedBySupport:0,hitsBuffedBy:new Map,hitsDebuffedBy:new Map},damageDealtDebuffedBy:new Map,damageDealtBuffedBy:new Map,damagePreventedByShieldBy:new Map,damagePreventedWithShieldOnOthersBy:new Map,shieldDoneBy:new Map,shieldReceivedBy:new Map,damagePreventedWithShieldOnOthers:0,damagePreventedByShield:0,shieldReceived:0,statApiValid:!1}}getBroadcast(){let e={...this.#e};return e.entities=new Map,this.#e.entities.forEach((n,o)=>{!n.isPlayer&&!n.isEsther||(n.statApiValid=this.#a.isCurrentZoneValid()&&this.#a.cache.get(n.name)?.status===2,e.entities.set(o,{...n}))}),e.localPlayer=this.#o.localPlayer.name,e}resetBreakdowns(){this.#t.clear()}createBreakdownEntity(e){return this.#t.has(e)||this.#t.set(e,new Map),this.#t.get(e)}removeBreakdownEntry(e){this.#t.delete(e)}addBreakdown(e,n,o){let s=this.createBreakdownEntity(e);if(s.has(n))s.get(n).push(o);else{let i=new Array(o);s.set(n,i)}}getBreakdowns(e,n){let o=this.#t.get(e);if(o)return o.get(n)}clearBreakdowns(e,n){let o=this.#t.get(e);o&&o.delete(n)}applyBreakdowns(e,n=!0){e.forEach(o=>{o.skills.forEach(s=>{let i=BigInt("0x"+o.id),a=this.getBreakdowns(i,s.id);a&&(s.breakdown=[...a])})}),n&&this.resetBreakdowns()}setKillState(e){this.#e.killState=e}setZoneLevel(e){this.#e.zoneLevel=De[e]}};var Zu=require("tiny-typed-emitter");function Ie(t){let e={};return e.points=t.u16(),e.level=t.u8(),e.id=t.u32(),e}function Ns(t){let e=new d(t),n={};return n.abilityDataList=e.array(e.u16(),()=>Ie(e),100),n}var Ds="PKTAbilityChangeNotify",Be=44427;function ku(t){let e={};return e.level=t.u32(),e.featureType=t.u16(),e}function gs(t){let e=new d(t),n={};return n.activeAbilityList=e.array(e.u16(),()=>ku(e),60),n.objectId=e.u64(),n}var Rs="PKTActiveAbilityNotify",Ce=29225;function Ls(t){let e=new d(t),n={};return n.addonFeatureIdList=e.bytes(e.u16(),200,4),n.addonSkillFeatureList=e.array(e.u16(),()=>{let o={};return o.addonSkillFeatureIdList=e.array(e.u16(),()=>e.u32(),5),o.skillId=e.u32(),o},200),n.objectId=e.u64(),n}var ws="PKTAddonSkillFeatureChangeNotify",Me=26726;function As(t){let e=new d(t),n={};return n.packetResultCode=e.u32(),n.unk1_m=e.bytes(e.u32(),688),n}var Ks="PKTAuthTokenResult",Bs=14686;function Cs(t){let e=new d(t),n={};return n.paralyzationPoint=e.u32(),n.type=e.u8(),e.skip(1),n.objectId=e.u64(),n.paralyzationMaxPoint=e.u32(),n}var Ms="PKTBlockSkillStateNotify",je=26677;function js(t){let e=new d(t),n={};return n.targetId=e.u64(),n.sourceId=e.u64(),n.type=e.u32(),e.skip(1),n}var Os="PKTCounterAttackNotify",Oe=13330;function Fs(t){let e=new d(t),n={};return n.unk0_m=e.u64(),e.bool()&&(n.abnormalStatusType=e.u8()),n.effectId=e.u32(),n.sourceId=e.u64(),n.targetId=e.u64(),n.durabilityDecrement=e.u8(),n.directionYaw=e.u16(),e.bool()&&(n.damageAttr=e.u8()),n.unk2_m=e.u32(),e.bool()&&(n.deathType=e.u8()),n}var qs="PKTDeathNotify",Fe=40622;function te(t){let e={};return t.bool()&&(e.unk1_0=t.u8()),e.level=t.u16(),e.itemTint=t.bytes(t.u16(),5,14),e.unk4=t.u8(),e.expireTime=W(t),e.slot=t.u16(),e.id=t.u32(),e}function Ws(t){let e=new d(t),n={};return n.objectId=e.u64(),n.unk1=e.u32(),n.unk2=e.u32(),n.equipItemDataList=e.array(e.u16(),()=>te(e),33),n}var Us="PKTEquipChangeNotify",qe=47337;function Vs(t){let e=new d(t),n={};return n.equipLifeToolDataList=e.array(e.u16(),()=>te(e),9),n.objectId=e.u64(),n}var Zs="PKTEquipLifeToolChangeNotify",We=29994;function zs(t){let e=new d(t),n={};return n.objectId=e.u64(),e.skip(1),n.stance=e.u8(),n}var Hs="PKTIdentityStanceChangeNotify",Ue=58886;function Gs(t){let e=new d(t),n={};return n.struct_140=e.bytes(e.u16(),353,48),n.abilityDataList=e.array(e.u16(),()=>Ie(e),100),n}var Ys="PKTInitAbility",Ve=33308;function $s(t){let e=new d(t),n={};return n.lostArkDateTime=W(e),n.unk1=e.u64(),n.unk2=e.u32(),n.playerId=e.u64(),n.unk4=e.u32(),n.struct_33=e.array(e.u16(),()=>{let o={};return o.versionString=e.string(64),o.struct_580=e.string(32),o.struct_597=e.string(128),o},64),n.struct_597=e.string(128),n.unk7=e.u8(),n}var Qs="PKTInitEnv",Ze=56231;function Ee(t){let e={};return e.unk0=t.u8(),e.unk1=t.u8(),e.unk2=T(t),e.unk3=t.u16(),e.unk4=t.u64(),e.unk5=T(t),e.unk6=t.u8(),e}function H(t){let e={};return e.stackCount=t.u8(),t.bool()&&(e.value=t.bytes(16)),e.skillLevel=t.u8(),e.sourceId=t.u64(),e.effectInstanceId=t.u32(),e.struct_442=t.bytes(t.u16(),8,7),e.statusEffectId=t.u32(),t.bool()&&(e.unk9_0=t.u64()),e.occurTime=W(t),e.endTick=t.u64(),e.totalTime=t.f32(),e}function Xs(t){let e=new d(t),n={};return n.unk0=e.u32(),n.unk1=e.u32(),n.unk2=e.u16(),n.unk3=e.u32(),n.unk4=e.u8(),n.characterId=e.u64(),n.unk6=e.u8(),n.unk7=e.u8(),n.struct_336=e.string(7),n.unk9=e.bytes(35),n.unk10=e.u32(),n.unk11=e.u8(),n.struct_342=e.bytes(e.u16(),104,30),n.unk13=e.u8(),n.unk14=e.u32(),n.unk15=e.u32(),n.unk16=e.u32(),n.unk17=e.u8(),n.statPair=e.array(e.u16(),()=>{let o={};return o.value=T(e),o.statType=e.u8(),o},153),n.unk19=e.u32(),n.level=e.u16(),n.unk21=e.u8(),n.unk22=e.u64(),n.unk23=e.u32(),n.unk24=e.u64(),e.bool()&&(n.unk26_0=e.u32()),n.unk27=e.u16(),n.struct_226=e.bytes(e.u16(),3,17),n.unk29=e.u8(),n.unk30=e.u64(),n.unk31=e.u32(),n.unk32=e.u64(),n.unk33=e.u8(),n.unk34=e.u8(),n.unk35=e.u8(),n.unk36=e.bytes(25),n.unk37=e.u64(),n.playerId=e.u64(),n.unk39=e.u8(),n.unk40=e.u16(),n.unk41=e.u8(),n.classId=e.u16(),n.unk43=e.u8(),n.unk44=e.u8(),n.unk45=e.u8(),n.name=e.string(20),n.struct_109=e.bytes(e.u16(),64),n.unk48=e.u32(),n.unk49=e.bytes(120),n.unk50=e.u8(),n.gearLevel=e.f32(),n.unk52=e.u8(),n.unk53=e.u8(),n.periodUpdateStatDataList=e.array(e.u16(),()=>Ee(e),5),n.unk55=e.u16(),n.statusEffectDatas=e.array(e.u16(),()=>H(e),80),n.unk57=e.u8(),n}var ys="PKTInitPC",ze=1329;function bu(t){let e={},n=t.u16();return n===1&&(e.unk1_0=t.bytes(n)),e}function Pu(t){let e={};return e.struct_149=t.bytes(t.u16(),3,9),e.unk1=t.u8(),e.unk2=t.u8(),e.unk3=t.u32(),e.unk4=t.u8(),e.struct_148=bu(t),e.unk6=t.u32(),e.unk7=t.u8(),e}function vu(t){let e={};return e.struct_236=t.array(t.u16(),()=>Pu(t),3),e.unk1=t.u32(),e.unk2=t.u32(),e.unk3=t.u16(),e.unk4=t.u32(),e.unk5=t.u32(),e.unk6=t.u32(),e.struct_261=t.bytes(t.u16(),2,9),e.struct_393=t.bytes(t.u16(),2,10),e.struct_238=t.bytes(t.u16(),10,18),e.unk10=t.u8(),e.struct_150=t.bytes(t.u16(),10,9),e.unk12=t.u64(),e.unk13=t.u32(),e}function Tu(t){let e={};return e.unk0=t.u8(),e.unk1=t.u8(),e.unk2=t.u16(),e.unk3=t.u8(),e.unk4=t.u16(),e.unk5=t.bytes(3),e.unk6=t.u16(),e.struct_102=t.bytes(t.u32(),51),e}function Iu(t){let e={};return e.unk0=t.u8(),e.unk1=t.bytes(t.u16(),7),t.bool()&&(e.struct_750=Tu(t)),e.unk4=t.bytes(t.u16(),7),e}function Eu(t){let e={};return e.unk0=t.u32(),e.struct_272=t.bytes(t.u16(),3,21),e.unk2=t.u32(),e.unk3=t.u32(),e.struct_437=t.bytes(t.u16(),3,10),e.unk5=t.u8(),e.struct_234=t.bytes(t.u16(),3,7),t.bool()&&(e.struct_790=Iu(t)),e.struct_240=t.bytes(t.u16(),10,29),t.bool()&&(e.struct_231=t.bytes(t.u16(),2,32)),e.unk12=t.u32(),e.itemTint=t.bytes(t.u16(),5,14),t.bool()&&(e.unk1_0=t.u32(),e.unk1_1=t.u32(),e.struct_194=t.bytes(t.u16(),5,30)),e.unk15=t.u32(),t.bool()&&(e.unk17_0=t.bytes(9)),e.unk18=t.u32(),t.bool()&&(e.unk20_0=t.bytes(10)),e}function tn(t){let e={};return e.npcId=t.u32(),e.isDead=t.bool(),e}function Nu(t){let e={};return e.unk0=t.u8(),e.struct_1=t.array(t.u16(),()=>{let n={};return n.struct_530=t.bytes(t.u16(),10),n.unk1_0_1=t.u32(),n},3),e.unk2=t.u32(),e.bossKillDataList=t.array(t.u16(),()=>tn(t),3),e.unk4=t.u8(),e}function Du(t){let e={};return e.struct_235=t.bytes(t.u16(),5,7),e.unk1=t.u8(),e.unk2=t.u8(),e.unk3=t.u8(),e.struct_234=t.bytes(t.u16(),3,7),e.struct_26=t.array(t.u16(),()=>{let n={};return n.unk1_0_0=t.u16(),n.struct_233=t.string(2),n.unk1_0_2=t.u8(),n},20),e}function gu(t){let e={},n=t.u8();return n===1&&(e.struct_666=vu(t)),n===2&&(e.struct_137=t.bytes(t.u16(),3,6),e.unk2_1=t.u8(),e.struct_2=t.array(t.u16(),()=>{let o={};return o.unk1_0_0=t.u8(),o.unk1_0_1=t.u32(),o.struct_530=t.bytes(t.u16(),10),o.unk1_0_3=t.u8(),o},3)),n===3&&(e.unk3_0=t.bytes(26)),n===4&&(e.unk4_0=t.bytes(t.u16(),10,13),e.unk4_1=t.bytes(t.u16(),10,13),e.unk4_2=t.u32()),n===5&&(e.struct_665=Eu(t)),n===6&&(e.struct_612=Nu(t)),n===7&&(e.unk7_0=t.bytes(9)),n===8&&(e.struct_658=Du(t)),n===9&&(e.unk9_0=t.u8()),e}function Ru(t){let e={};return t.u32()>0&&(e.serialNumber=t.u64(),e.id=t.u32(),e.level=t.u16(),e.slot=t.u16(),e.durability=t.u32(),e.unk1_6_m=t.u32(),e.flag=t.u32(),e.expireTime=W(t),e.lockUpdateTime=W(t),t.bool()&&(e.unk1_10_0=t.bytes(9)),e.unk1_11=t.u8(),e.unk1_12=t.u8(),e.unk1_13=t.u32(),e.struct_567=gu(t),e.unk1_15=t.u32()),e}function ei(t){let e=new d(t),n={};return n.itemDataList=e.array(e.u16(),()=>Ru(e),80),n.storageType=e.u8(),n}var ti="PKTInitItem",He=14657;function Lu(t){let e={};return t.bool()&&(e.unk1_0=t.bytes(9)),t.bool()&&(e.unk3_0=t.u32()),e.unk4=t.u32(),e.unk5=t.u32(),e.unk6=t.u32(),e}function ni(t){let e=new d(t),n={};return n.addonFeatureIdList=e.bytes(e.u16(),200,4),n.statusEffectDatas=e.array(e.u16(),()=>H(e),80),n.addonSkillFeatureList=e.array(e.u16(),()=>{let o={};return o.addonSkillFeatureIdList=e.array(e.u16(),()=>e.u32(),5),o.skillId=e.u32(),o},200),n.unk3=e.u8(),n.unk4=e.u64(),n.unk5=e.u32(),e.bool()&&(n.unk7_0=e.u32()),n.struct_140=e.bytes(e.u16(),353,48),n.statPair=e.array(e.u16(),()=>{let o={};return o.value=T(e),o.statType=e.u8(),o},153),n.struct_226=e.bytes(e.u16(),3,17),n.unk11=e.u8(),n.unk12=e.u64(),n.struct_342=e.bytes(e.u16(),104,30),n.abilityDataList=e.array(e.u16(),()=>Ie(e),100),n.unk15=e.u8(),n.struct_421=e.array(e.u16(),()=>Lu(e),300),n}var oi="PKTInitLocal",Ge=18172;function ai(t){let e=new d(t),n={};return n.serverAddr=e.string(256),n.account_CharacterId1=e.u64(),n.account_CharacterId2=e.u64(),n.unk3=e.u32(),n}var si="PKTMigrationExecute",Ye=1184;function wu(t){let e={};return e.unk0=t.u64(),e.unk1=t.u16(),e.unk2=t.u64(),e.unk3=t.u8(),e.lostArkString=t.string(20),e.unk5=t.u8(),e.equipItemDataList=t.array(t.u16(),()=>te(t),33),e.unk7=t.u8(),e.lookData=t.bytes(t.u32(),512),e}function nn(t){let e={};return t.bool()&&(e.unk1_0=t.u64()),t.bool()&&(e.struct_734=wu(t)),t.bool()&&(e.unk5_0=t.u8()),t.bool()&&(e.balanceLevel=t.u16()),t.bool()&&(e.transitIndex=t.u32()),t.bool()&&(e.unk11_0=t.u16()),e.level=t.u16(),e.unk13=t.u8(),t.bool()&&(e.unk15_0=t.u32()),t.bool()&&(e.unk17_0=t.u8()),t.bool()&&(e.unk19_0=t.u8()),t.bool()&&(e.unk21_0=t.u32()),e.statPair=t.array(t.u16(),()=>{let n={};return n.value=T(t),n.statType=t.u8(),n},153),t.bool()&&(e.unk24_0=t.u8()),t.bool()&&(e.unk26_0=t.u8()),e.statusEffectDatas=t.array(t.u16(),()=>H(t),80),t.bool()&&(e.unk29_0=t.u32()),e.position=N(t),e.spawnIndex=t.u32(),t.bool()&&(e.unk33_0=t.u32()),e.objectId=t.u64(),t.bool()&&(e.struct_273=t.bytes(t.u16(),12,12)),t.bool()&&(e.unk38_0=t.u8()),e.unk39=t.u8(),e.unk40=t.u8(),t.bool()&&(e.struct_337=t.bytes(t.u16(),11,9)),e.periodUpdateStatDataList=t.array(t.u16(),()=>Ee(t),5),t.bool()&&(e.unk45_0=t.u8()),e.unk46=t.u8(),e.unk47=t.u8(),e.typeId=t.u32(),e.directionYaw=K(t),e.unk50=t.u8(),e}function ii(t){let e=new d(t),n={};return e.bool()&&(n.unk1_0=e.u8()),n.unk2=e.u8(),n.npcStruct=nn(e),e.bool()&&(n.unk5_0=e.u64()),e.bool()&&(n.unk1_0_0=e.string(20),n.unk1_1=e.string(20)),n}var ri="PKTNewNpc",$e=50175;function ui(t){let e=new d(t),n={};return n.npcData=nn(e),e.skip(34),n.ownerId=e.u64(),e.skip(1),n.publishReason=e.u8(),n}var mi="PKTNewNpcSummon",Qe=8401;function Ku(t){let e={};return e.unk0=t.bytes(12),e.unk1=t.u32(),t.bool()&&(e.unk3_0=t.bytes(12)),e.unk4=t.u32(),e}function Bu(t){let e={};return e.avgItemLevel=t.f32(),e.equipLifeToolDataList=t.array(t.u16(),()=>te(t),9),e.unk2=t.u32(),e.unk23_m=t.u8(),e.unk0_m=t.bytes(5),e.addonSkillFeatureList=t.array(t.u16(),()=>{let n={};return n.addonSkillFeatureIdList=t.array(t.u16(),()=>t.u32(),5),n.skillId=t.u32(),n},200),e.rvRLevel=t.u16(),e.lookData=t.bytes(t.u32(),512),e.guildName=t.string(20),e.unk1_m=t.u8(),e.firstHonorTitleId=t.u16(),e.worldId=t.u8(),e.unk29_m=t.u8(),e.statusEffectDatas=t.array(t.u16(),()=>H(t),80),e.unk14=t.u32(),e.unk4_m=t.u32(),e.level=t.u16(),e.unk17_m=t.u8(),e.addonFeatureIdList=t.bytes(t.u16(),200,4),e.unk45_m=t.u32(),e.position=N(t),e.name=t.string(20),e.equipItemDataList=t.array(t.u16(),()=>te(t),33),e.unk23=t.u8(),e.guildId=t.u64(),e.periodUpdateStatDataList=t.array(t.u16(),()=>Ee(t),5),e.unk5_m=t.u32(),e.unk27=t.u8(),e.unk28=t.u32(),e.unk29=t.u8(),e.classId=t.u16(),e.avatarHide=t.u8(),e.unk32=t.u64(),e.statPair=t.array(t.u16(),()=>{let n={};return n.value=T(t),n.statType=t.u8(),n},153),e.maxItemLevel=t.f32(),e.unk7_m=t.u32(),e.unk2_m=t.u8(),e.identityData=t.bytes(25),e.playerId=t.u64(),e.petId=t.u32(),e.secondHonorTitleId=t.u16(),t.bool()&&(e.grabbedData=t.bytes(12)),e.heading=K(t),e.unk32_m=t.u8(),e.unk25_m=t.u8(),e.characterId=t.u64(),e}function _i(t){let e=new d(t),n={};return n.unk2_m=e.u8(),e.bool()&&(n.struct_64=e.array(e.u16(),()=>{let o={};return o.unk1_0_0=e.u32(),o.unk1_0_1=e.u64(),o.itemTint=e.bytes(e.u16(),5,14),o},5)),e.bool()&&(n.itemTint=e.bytes(e.u16(),5,14),n.unk1_1=e.u64(),n.unk1_2=e.u32()),n.unk0_m=e.u8(),e.bool()&&(n.trackMoveInfo=Ku(e)),n.pcStruct=Bu(e),e.bool()&&(n.unk4_0_m=e.bytes(12)),e.bool()&&(n.unk5_0_m=e.bytes(20)),e.bool()&&(n.unk3_0_m=e.u32()),n}var li="PKTNewPC",Je=24705;function Cu(t){let e={};return e.unk0=t.u8(),t.bool()&&(e.unk2_0=t.u64()),e.tripodLevel=Te(t),e.unk4=t.u32(),e.unk5=t.u32(),e.unk6=t.u16(),e.targetObjectId=t.u64(),e.ownerId=t.u64(),e.unk9=t.u8(),e.unk10=t.u64(),t.bool()&&(e.unk12_0=t.u32()),t.bool()&&(e.struct_337=t.bytes(t.u16(),11,9)),e.tripodIndex=ve(t),e.chainSkillEffect=t.u32(),e.skillLevel=t.u8(),e.unk18=t.u16(),e.skillId=t.u32(),e.projectileId=t.u64(),e.unk21=t.u32(),e.skillEffect=t.u32(),e.unk23=t.u64(),e}function fi(t){let e=new d(t),n={};return n.projectileInfo=Cu(e),n}var ci="PKTNewProjectile",Xe=44644;function Mu(t){let e={};return e.ownerId=t.u64(),e.objectId=t.u64(),e.skillId=t.u32(),e.unk3=t.u32(),e.unk4=t.u32(),e.unk5=t.u32(),e.unk6=t.u8(),t.bool()&&(e.struct_337=t.bytes(t.u16(),11,9)),e.skillEffect=t.u32(),e.unk10=t.u8(),e.unk11=t.u16(),e.position=N(t),e.unk13=t.u8(),e}function di(t){let e=new d(t),n={};return n.unk0=e.u8(),n.trapData=Mu(e),n.unk2=e.u8(),n}var pi="PKTNewTrap",ye=51471;function hi(t){let e=new d(t),n={};return n.paralyzationMaxPoint=e.u32(),n.enable=e.bool(),n.hitCheckTime=e.u32(),n.paralyzationPoint=e.u32(),n.objectId=e.u64(),e.skip(1),n.decreasePoint=e.u32(),e.skip(1),n.noHitCheckTime=e.u32(),e.skip(1),n}var Si="PKTParalyzationStateNotify",et=55896;function ju(t){let e={};return e.characterLevel=t.u16(),e.name=t.string(20),e.curHp=T(t),e.position=N(t),e.auths=t.u8(),e.classId=t.u16(),e.zoneInstId=t.u64(),e.unk7=t.u8(),e.gearLevel=t.f32(),e.unk9=t.u16(),e.zoneId=t.u32(),e.transitIndex=t.u32(),e.unk12=t.u8(),e.unk13=t.u8(),e.worldId=t.u8(),e.partyMemberNumber=t.u8(),e.characterId=t.u64(),e.unk17=t.u8(),e.maxHp=T(t),e.unk19=t.u8(),e}function ki(t){let e=new d(t),n={};return n.partyInstanceId=e.u32(),n.memberDatas=e.array(e.u16(),()=>ju(e),40),n.partyType=e.u8(),n.lootGrade=e.u32(),n.partyLootType=e.u8(),n.raidInstanceId=e.u32(),n}var bi="PKTPartyInfo",tt=17285;function Pi(t){let e=new d(t),n={};return n.name=e.string(20),n.partyInstanceId=e.u32(),n.partyLeaveType=e.u8(),n}var vi="PKTPartyLeaveResult",nt=44646;function Ti(t){let e=new d(t),n={};return n.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),n.unk0_m=e.u8(),n.objectId=e.u64(),n}var Ii="PKTPartyPassiveStatusEffectAddNotify",ot=26921;function Ei(t){let e=new d(t),n={};return n.objectId=e.u64(),n.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),n}var xi="PKTPartyPassiveStatusEffectRemoveNotify",at=46564;function Ni(t){let e=new d(t),n={};return n.unk0=e.u64(),n.playerIdOnRefresh=e.u64(),n.unk2=e.u8(),n.statusEffectDatas=e.array(e.u16(),()=>H(e),80),n.characterId=e.u64(),n}var Di="PKTPartyStatusEffectAddNotify",st=44546;function gi(t){let e=new d(t),n={};return n.unk0=e.u64(),n.statusEffectIds=e.array(e.u16(),()=>e.u32(),80),n.reason=e.u8(),n.characterId=e.u64(),n}var Ri="PKTPartyStatusEffectRemoveNotify",it=10041;function Li(t){let e=new d(t),n={};return e.skip(8),n.raidInstanceId=e.u32(),e.skip(1),n.characterId=e.u64(),n.partyInstanceId=e.u32(),e.skip(17),n}var wi="PKTPartyStatusEffectResultNotify",rt=13786;function Ai(t){let e=new d(t),n={};return n.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),n}var Ki="PKTPassiveStatusEffectAddNotify",ut=53848;function Bi(t){let e=new d(t),n={};return n.passiveStatusEffectList=e.array(e.u16(),()=>e.u32(),10),n}var Ci="PKTPassiveStatusEffectRemoveNotify",mt=56637;function Mi(t){let e=new d(t),n={};return n.endTick=e.u64(),n.unk6_m=e.u64(),n.raidResult=e.u8(),n.bossKillDataList=e.array(e.u16(),()=>tn(e),3),n.unk4_m=e.u64(),n.unk0_m=e.bool(),n.unk5_m=e.u64(),n.startTick=e.u64(),n.totalTime=e.u64(),n.braveHeartCount=e.u8(),n.raidId=e.u32(),n.initBraveHeartCount=e.u8(),n.unk1_m=e.bool(),n.unk11_m=e.bool(),n}var ji="PKTRaidBegin",_t=22851;function Oi(t){let e=new d(t),n={};return e.skip(1),n.typeId=e.u32(),n}var Fi="PKTRaidBossKillNotify",lt=38330;function qi(t){let e=new d(t),n={};return n.struct_54=e.array(e.u16(),()=>{let o={};return o.unk1_0_0=T(e),o.unk1_0_1=e.u32(),o.unk1_0_2=T(e),o.struct_535=e.bytes(e.u16(),3),o},3),n.unk1=e.u64(),n.raidResult=e.u8(),n.unk3=e.u8(),n.unk4=e.u8(),n.unk5=e.u64(),n.unk6=e.u64(),n.unk7=e.u64(),n}var Wi="PKTRaidResult",ft=10064;function Ou(t){let e={};return e.unpublishReason=t.u8(),e.objectId=t.u64(),e}function Ui(t){let e=new d(t),n={};return n.unpublishedObjects=e.array(e.u16(),()=>Ou(e),200),n}var Vi="PKTRemoveObject",ct=35384;function Zi(t){let e=new d(t),n={};return e.skip(1),n.skillId=e.u32(),n.newDirectionYaw=K(e),e.skip(1),n.cancelReason=e.u8(),n.newPosition=N(e),n.caster=e.u64(),n}var zi="PKTSkillCancelNotify",dt=13094;function Hi(t){let e=new d(t),n={};return e.skip(1),n.skillId=e.u32(),n.caster=e.u64(),e.skip(1),n.skillLevel=e.u8(),n}var Gi="PKTSkillCastNotify",pt=39612;function on(t){let e={};return e.maxHp=T(t),e.damageType=t.u8(),e.unk3_m=t.u16(),t.bool()&&(e.damageAttr=t.u8()),e.curHp=T(t),e.targetId=t.u64(),e.damage=T(t),e.modifier=t.u8(),e}function qu(t){let e={};return e.skillMoveOptionData=Yt(t),e.destination=N(t),e.unk8_m=t.u16(),e.unk4_m=t.u16(),e.skillDamageEvent=on(t),e.position=N(t),e.unk3_m=t.u16(),e.unk1_m=t.u8(),e.unk2_m=t.u64(),e}function Yi(t){let e=new d(t),n={};return n.unk2_m=e.u32(),n.unk1_m=e.u8(),n.skillDamageAbnormalMoveEvents=e.array(e.u16(),()=>qu(e),50),n.skillEffectId=e.u32(),n.skillId=e.u32(),n.sourceId=e.u64(),n}var $i="PKTSkillDamageAbnormalMoveNotify",ht=4102;function Qi(t){let e=new d(t),n={};return e.bool()&&(n.unk1_0=e.u32()),n.skillId=e.u32(),n.sourceId=e.u64(),n.skillLevel=e.u8(),e.bool()&&(n.skillEffectId=e.u32()),n.skillDamageEvents=e.array(e.u16(),()=>on(e),50),n}var Ji="PKTSkillDamageNotify",St=26079;function Xi(t){let e=new d(t),n={};return e.skip(8),n.stage=e.u8(),n.skillId=e.u32(),e.skip(14),n.sourceId=e.u64(),e.skip(19),n}var yi="PKTSkillStageNotify",kt=10317;function er(t){let e=new d(t),n={};return n.skillOptionData=Jt(e),n.newPosition=N(e),n.sourceId=e.u64(),n.aimTargetPosition=N(e),n.skillLevel=e.u8(),e.bool()&&(n.pitchRotation=K(e)),n.curPosition=N(e),e.bool()&&(n.aiStateId=e.u32()),n.newDirectionYaw=K(e),n.skillId=e.u32(),n.curDirectionYaw=K(e),e.bool()&&(n.unk1_m=e.u32()),n}var tr="PKTSkillStartNotify",bt=53701;function nr(t){let e=new d(t),n={};return n.unk0=e.u8(),n.unk1=e.array(e.u16(),()=>{let o={};return o.value=T(e),o.statType=e.u8(),o},153),e.bool()&&(n.unk3_0=e.u32()),n.unk4=e.array(e.u16(),()=>{let o={};return o.value=T(e),o.statType=e.u8(),o},153),n.objectId=e.u64(),n}var or="PKTStatChangeOriginNotify",ar=29922;function sr(t){let e=new d(t),n={};return n.objectId=e.u64(),n.unk1=e.u64(),n.statusEffectData=H(e),e.bool()&&(n.unk4_0=e.u64()),n.new=e.bool(),n}var ir="PKTStatusEffectAddNotify",Pt=35829;function rr(t){let e=new d(t),n={};return n.statusEffectIds=e.array(e.u16(),()=>e.u32(),80),n.reason=e.u8(),n.objectId=e.u64(),n}var ur="PKTStatusEffectRemoveNotify",vt=16493;function mr(t){let e=new d(t),n={};return e.skip(2),n.targetId=e.u64(),n.expirationTick=e.u64(),n.effectInstanceId=e.u32(),e.skip(2),n}var _r="PKTStatusEffectDurationNotify",Tt=40374;function lr(t){let e=new d(t),n={};return e.skip(3),n.characterId=e.u64(),n.value=e.u32(),e.skip(4),n.objectId=e.u64(),n.effectInstanceId=e.u32(),n}var fr="PKTStatusEffectSyncDataNotify",It=10020;function cr(t){let e=new d(t),n={};return n.step=e.u32(),n.triggerId=e.u32(),e.skip(1),n.unk2_m=e.bool(),n}var dr="PKTTriggerBossBattleStatus",Et=12536;function pr(t){let e=new d(t),n={};return n.packetResultCode=e.u32(),n.triggerId=e.u32(),n.unk0_m=e.u32(),n.involvedPCs=e.array(e.u16(),()=>e.u64(),40),n}var hr="PKTTriggerFinishNotify",xt=43956;function Sr(t){let e=new d(t),n={};return n.triggerId=e.u32(),n.involvedPCs=e.array(e.u16(),()=>e.u64(),40),n.sourceId=e.u64(),n.triggerSignalType=e.u32(),n}var kr="PKTTriggerStartNotify",Nt=7488;function br(t){let e=new d(t),n={};return n.characterId=e.u64(),n.maxHp=T(e),n.position=e.u64(),n.unk0_m=e.u32(),n.curHp=T(e),n.statusEffectDatas=e.array(e.u16(),()=>H(e),80),n}var Pr="PKTTroopMemberUpdateMinNotify",Dt=45338;function vr(t){let e=new d(t),n={};return e.skip(1),n.identityGauge1=e.u32(),n.identityGauge2=e.u32(),n.identityGauge3=e.u32(),e.skip(3),n.playerId=e.u64(),n}var Tr="PKTIdentityGaugeChangeNotify",gt=2589;function Ir(t){let e=new d(t),n={};return n.totalMembers=e.array(e.u16(),()=>e.u64(),40),n.completeMembers=e.array(e.u16(),()=>e.u64(),40),n.zoneLevel=e.u8(),n.loadComplete=e.bool(),n.firstPCEnterTick=e.u64(),n.zoneId=e.u32(),n.zoneInstId=e.u64(),n}var Er="PKTZoneMemberLoadStatusNotify",Rt=53608;function xr(t){let e=new d(t),n={};return e.skip(2),n.objectId=e.u64(),e.skip(1),n}var Nr="PKTZoneObjectUnpublishNotify",Lt=9489;function Wu(t){let e={};return e.instanceId=t.u32(),t.skip(4),e.stackCount=t.u8(),e.id=t.u32(),e.target=t.u8(),e}function Dr(t){let e=new d(t),n={};return n.zoneStatusEffectDataList=e.array(e.u16(),()=>Wu(e),4),n}var gr="PKTZoneStatusEffectAddNotify",wt=59381;function Rr(t){let e=new d(t),n={};return e.skip(1),n.statusEffectId=e.u32(),n}var Lr="PKTZoneStatusEffectRemoveNotify",At=7555;var wr=new Map([[Be,[Ds,Ns]],[Ce,[Rs,gs]],[Me,[ws,Ls]],[Bs,[Ks,As]],[je,[Ms,Cs]],[Oe,[Os,js]],[Fe,[qs,Fs]],[qe,[Us,Ws]],[We,[Zs,Vs]],[Ue,[Hs,zs]],[Ve,[Ys,Gs]],[Ze,[Qs,$s]],[ze,[ys,Xs]],[He,[ti,ei]],[Ge,[oi,ni]],[Ye,[si,ai]],[$e,[ri,ii]],[Qe,[mi,ui]],[Je,[li,_i]],[Xe,[ci,fi]],[ye,[pi,di]],[et,[Si,hi]],[tt,[bi,ki]],[nt,[vi,Pi]],[ot,[Ii,Ti]],[at,[xi,Ei]],[st,[Di,Ni]],[it,[Ri,gi]],[rt,[wi,Li]],[ut,[Ki,Ai]],[mt,[Ci,Bi]],[_t,[ji,Mi]],[lt,[Fi,Oi]],[ft,[Wi,qi]],[ct,[Vi,Ui]],[dt,[zi,Zi]],[pt,[Gi,Hi]],[ht,[$i,Yi]],[St,[Ji,Qi]],[kt,[yi,Xi]],[bt,[tr,er]],[ar,[or,nr]],[Pt,[ir,sr]],[vt,[ur,rr]],[Tt,[_r,mr]],[It,[fr,lr]],[Et,[dr,cr]],[xt,[hr,pr]],[Nt,[kr,Sr]],[Dt,[Pr,br]],[gt,[Tr,vr]],[Rt,[Er,Ir]],[Lt,[Nr,xr]],[wt,[gr,Dr]],[At,[Lr,Rr]]]);var Vu=new Map([[Be,[0]],[Ce,[1]],[Me,[2]],[je,[4]],[Oe,[5]],[Fe,[6]],[Ve,[7]],[Ze,[8]],[ze,[9]],[Ge,[10]],[Ye,[11]],[$e,[12]],[Qe,[13]],[Je,[14]],[Xe,[15]],[et,[16]],[tt,[17]],[nt,[18]],[ot,[19]],[at,[20]],[st,[21]],[it,[22]],[rt,[23]],[ut,[24]],[mt,[25]],[lt,[26]],[ft,[27]],[ct,[28]],[ht,[29]],[St,[30]],[kt,[31]],[bt,[32]],[Pt,[34]],[vt,[35]],[Tt,[36]],[It,[37]],[Et,[38]],[xt,[39]],[Nt,[40]],[Dt,[41]],[gt,[42]],[Lt,[43]],[wt,[44]],[At,[45]],[pt,[46]],[Ue,[47]],[qe,[48]],[We,[49]],[He,[50]],[_t,[52]],[Rt,[51]],[ye,[53]],[dt,[54]]]);var Ym=require("tiny-typed-emitter");var an=class{#e;#o;#i;#a;#n;#t;constructor(e,n,o,s,i,a){this.#e=e,this.#o=n,this.#i=o,this.#a=s,this.#n=i,this.#t=a}#s;get parsed(){if(!this.#s)try{this.#s=this.#t(this.#n.decrypt(this.#e,this.#o,this.#i,this.#a))}catch(e){console.error(`[meter-core/pkt-stream] - ${e}`);return}return this.#s}};var zu=require("fs");var Ar=class extends Zu.TypedEmitter{},sn=class extends Ar{#e;#o;constructor(e,n,o){super(),this.#e=n,o&&(this.#o=(0,zu.createWriteStream)(o,{highWaterMark:0}));let s=Buffer.allocUnsafe(cn);s.writeUIntLE(5,0,cn),this.#o?.write(s),e.on("*",this.handlePkt.bind(this))}handlePkt(e,n,o,s){try{let i=wr.get(n),a=Vu.get(n);if(i&&a){let[m]=a,[f,l]=i,k=Xt.get(m);if(k){let[h,v,G]=k,B=new an(Buffer.from(e),n,o,!!s,this.#e,l).parsed;if(!B)return;let Q=new oe(B,m,G);this.emit(h,Q),this.emit("*",h,Q),this.appendLog(Q)}}}catch(i){console.error(i)}}appendLog(e){this.#o&&e.serialized&&this.#o.write(e.serialized)}};var rn=class{characterIdToPartyId;entityIdToPartyId;raidInstanceToPartyInstances;ownName;characterNameToCharacterId;#e;constructor(e){this.characterIdToPartyId=new Map,this.entityIdToPartyId=new Map,this.raidInstanceToPartyInstances=new Map,this.characterNameToCharacterId=new Map,this.#e=e}add(e,n,o=void 0,s=void 0,i=void 0){!o&&!s||(o&&!s&&(s=this.#e.getEntityId(o)),s&&!o&&(o=this.#e.getEntityId(s)),o&&this.characterIdToPartyId.set(o,n),s&&this.entityIdToPartyId.set(s,n),i&&o&&this.characterNameToCharacterId.set(i,o),this.registerPartyId(e,n))}completeEntry(e,n){let o=this.getPartyIdFromCharacterId(e),s=this.getPartyIdFromEntityId(n);o&&s||(!o&&s&&this.characterIdToPartyId.set(e,s),!s&&o&&this.entityIdToPartyId.set(n,o))}changeEntityId(e,n){let o=this.getPartyIdFromEntityId(e);o&&(this.entityIdToPartyId.delete(e),this.entityIdToPartyId.set(n,o))}setOwnName(e){this.ownName=e}remove(e,n){if(n===this.ownName){this.removePartyMappings(e);return}let o=this.characterNameToCharacterId.get(n);if(this.characterNameToCharacterId.delete(n),!o)return;this.characterIdToPartyId.delete(o);let s=this.#e.getEntityId(o);s&&this.characterIdToPartyId.delete(s)}isCharacterInParty(e){return this.characterIdToPartyId.has(e)}isEntityInParty(e){return this.entityIdToPartyId.has(e)}getPartyIdFromCharacterId(e){return this.characterIdToPartyId.get(e)}getPartyIdFromEntityId(e){return this.entityIdToPartyId.get(e)}removePartyMappings(e){let n=this.getRaidInstanceId(e),o=n?this.raidInstanceToPartyInstances.get(n)??new Set([e]):new Set([e]);for(let[s,i]of this.characterIdToPartyId)if(o.has(i)){this.characterIdToPartyId.delete(s);for(let[a,m]of this.characterNameToCharacterId)if(s===m){this.characterNameToCharacterId.delete(a);break}}for(let[s,i]of this.entityIdToPartyId)o.has(i)&&this.entityIdToPartyId.delete(s)}getRaidInstanceId(e){for(let n of this.raidInstanceToPartyInstances)if(n[1].has(e))return n[0]}registerPartyId(e,n){let o=this.raidInstanceToPartyInstances.get(e);o||(o=new Set,this.raidInstanceToPartyInstances.set(e,o)),o.add(n)}partyInfo(e,n,o){let s=e.parsed;if(s){if(s.memberDatas.length===1&&s.memberDatas[0]?.name===o.name){this.remove(s.partyInstanceId,s.memberDatas[0].name);return}this.removePartyMappings(s.partyInstanceId);for(let i of s.memberDatas){i.characterId===o.characterId&&this.setOwnName(i.name);let a=this.#e.getEntityId(i.characterId);if(a){let m=n.get(a);if(m&&m.entityType===1&&m.name!==i.name){let f=m;f.gearLevel=i.gearLevel,f.name=i.name,f.class=i.classId}}this.add(s.raidInstanceId,s.partyInstanceId,i.characterId,a,i.name)}}}};var un=class{entityToCharacterId;characterToEntityId;constructor(){this.entityToCharacterId=new Map,this.characterToEntityId=new Map}addMapping(e,n){this.entityToCharacterId.set(n,e),this.characterToEntityId.set(e,n)}getCharacterId(e){return this.entityToCharacterId.get(e)}getEntityId(e){return this.characterToEntityId.get(e)}clear(){this.entityToCharacterId.clear(),this.characterToEntityId.clear()}};var Kr=class extends Gu.TypedEmitter{#e;#o;#i;#a;#n;#t;#s;#r;#u;#m;constructor(e,n,o,s){super(),this.#e=e,this.#o=n,this.#i=new un,this.#a=new rn(this.#i),this.#n=new ge(this.#a,this.#o,s.isLive??!0),this.#t=new Ut(this.#i,this.#a,this.#n,this.#o),this.#r=new Ae(this.#t,o,Hu(this.#e,s.isLive)?this.#e:void 0),this.#s=new yt(this.#t,this.#n,this.#r,this.#o,s),this.#s.emit=this.emit.bind(this),this.#u=!1,this.#m=!1,this.#s.options.isLive&&setInterval(this.broadcastStateChange.bind(this),100),this.#e.on("APP_StatApi",i=>{let a=i.parsed;a&&this.#r.updatePlayerStats(a.players)}).on("AbilityChangeNotify",i=>{}).on("ActiveAbilityNotify",i=>{}).on("AddonSkillFeatureChangeNotify",i=>{}).on("BlockSkillStateNotify",i=>{}).on("CounterAttackNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.entities.get(a.sourceId);m&&this.#s.onCounterAttack(m,i.time)}).on("DeathNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.entities.get(a.targetId);m&&this.#s.onDeath(m,i.time)}).on("EquipChangeNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.entities.get(a.objectId);if(!m||m.entityType!==1)return;m.itemSet=this.#t.getPlayerSetOptions(a.equipItemDataList);let f=[];a.equipItemDataList.forEach(l=>{l.id!==void 0&&l.slot!==void 0&&f.push({id:l.id,slot:l.slot})}),m.items.equipList=f}).on("EquipLifeToolChangeNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.entities.get(a.objectId);if(!m||m.entityType!==1)return;let f=[];a.equipLifeToolDataList.forEach(l=>{l.id!==void 0&&l.slot!==void 0&&f.push({id:l.id,slot:l.slot})}),m.items.lifeToolList=f}).on("IdentityStanceChangeNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.entities.get(a.objectId);m&&m.entityType===1&&(m.stance=a.stance)}).on("IdentityGaugeChangeNotify",i=>{}).on("InitAbility",i=>{}).on("InitEnv",i=>{this.#t.processInitEnv(i),this.#s.onInitEnv(i,i.time)}).on("InitLocal",i=>{}).on("InitPC",i=>{let a=this.#t.processInitPC(i);if(a&&i.parsed){let m=this.#o.getStatPairMap(i.parsed.statPair);this.#s.updateOrCreateEntity(a,{id:a.entityId.toString(16),name:a.name,classId:a.class,isPlayer:!0,gearScore:a.gearLevel,currentHp:Number(m.get(1))||0,maxHp:Number(m.get(27))||0},i.time)}}).on("InitItem",i=>{let a=i.parsed;if(a){if([1,20].includes(a.storageType)){this.#t.localPlayer.itemSet=this.#t.getPlayerSetOptions(a.itemDataList);let m=[];a.itemDataList.forEach(f=>{f.id!==void 0&&f.slot!==void 0&&m.push({id:f.id,slot:f.slot})}),this.#t.localPlayer.items.equipList=m}else if(a.storageType===21){let m=[];a.itemDataList.forEach(f=>{f.id!==void 0&&f.slot!==void 0&&m.push({id:f.id,slot:f.slot})}),this.#t.localPlayer.items.lifeToolList=m}}}).on("MigrationExecute",i=>{this.#r.zoneSyncStatus=0;let a=i.parsed;a&&(this.#t.localPlayer.characterId===0n&&(this.#t.localPlayer.characterId=a.account_CharacterId1<a.account_CharacterId2?a.account_CharacterId1:a.account_CharacterId2),this.#r.ip=i.parsed.serverAddr.split(":")[0])}).on("NewNpc",i=>{let a=this.#t.processNewNpc(i);if(a&&i.parsed){let m=this.#o.getStatPairMap(i.parsed.npcStruct.statPair);this.#s.updateOrCreateEntity(a,{id:a.entityId.toString(16),name:a.name,npcId:a.typeId,isPlayer:!1,isBoss:a.isBoss,currentHp:Number(m.get(1))||0,maxHp:Number(m.get(27))||0},i.time)}}).on("NewNpcSummon",i=>{let a=this.#t.processNewNpcSummon(i);if(a&&i.parsed){let m=this.#o.getStatPairMap(i.parsed.npcData.statPair);this.#s.updateOrCreateEntity(a,{id:a.entityId.toString(16),name:a.name,npcId:a.typeId,isPlayer:!1,isBoss:a.isBoss,currentHp:Number(m.get(1))||0,maxHp:Number(m.get(27))||0},i.time)}}).on("NewPC",i=>{let a=this.#t.processNewPC(i);if(a&&i.parsed){let m=this.#o.getStatPairMap(i.parsed.pcStruct.statPair);this.#s.updateOrCreateEntity(a,{id:a.entityId.toString(16),name:a.name,classId:a.class,isPlayer:!0,gearScore:a.gearLevel,currentHp:Number(m.get(1))||0,maxHp:Number(m.get(27))||0},i.time)}}).on("NewProjectile",i=>{let a=i.parsed;if(!a)return;let m={entityId:a.projectileInfo.projectileId,entityType:5,name:a.projectileInfo.projectileId.toString(16),ownerId:a.projectileInfo.ownerId,skillEffectId:a.projectileInfo.skillEffect,skillId:a.projectileInfo.skillId,stats:new Map};this.#t.entities.set(m.entityId,m)}).on("NewTrap",i=>{let a=i.parsed;if(!a)return;let m={entityId:a.trapData.objectId,entityType:5,name:a.trapData.objectId.toString(16),ownerId:a.trapData.ownerId,skillEffectId:a.trapData.skillEffect,skillId:a.trapData.skillId,stats:new Map};this.#t.entities.set(m.entityId,m)}).on("ParalyzationStateNotify",i=>{}).on("PartyInfo",i=>{this.#a.partyInfo(i,this.#t.entities,this.#t.localPlayer)}).on("PartyLeaveResult",i=>{let a=i.parsed;a&&this.#a.remove(a.partyInstanceId,a.name)}).on("PartyPassiveStatusEffectAddNotify",i=>{}).on("PartyPassiveStatusEffectRemoveNotify",i=>{}).on("PartyStatusEffectAddNotify",i=>{let a=i.parsed;if(a)for(let m of a.statusEffectDatas){let f=a.playerIdOnRefresh!==0n?a.playerIdOnRefresh:m.sourceId,l=this.#t.getSourceEntity(f);this.#n.RegisterStatusEffect(this.#n.buildStatusEffect(m,a.characterId,l.entityId,0,i.time))}}).on("PartyStatusEffectRemoveNotify",i=>{let a=i.parsed;if(a)for(let m of a.statusEffectIds){let f=this.#n.RemoveStatusEffect(a.characterId,m,0,a.reason,i.time);f&&f.statusEffectId===9701&&this.#r.syncData()}}).on("PartyStatusEffectResultNotify",i=>{let a=i.parsed;a&&this.#a.add(a.raidInstanceId,a.partyInstanceId,a.characterId)}).on("PassiveStatusEffectAddNotify",i=>{}).on("PassiveStatusEffectRemoveNotify",i=>{}).on("RaidBegin",i=>{let a=i.parsed;a&&(this.#o.statQueryFilter.raid.has(a.raidId)?this.#r.zoneSyncStatus|=16:this.#r.zoneSyncStatus|=8)}).on("ZoneMemberLoadStatusNotify",i=>{let a=i.parsed;a&&(this.#s.setZoneLevel(a.zoneLevel),this.#o.statQueryFilter.zone.has(a.zoneId)&&[0,1,5].includes(a.zoneLevel)?this.#r.zoneSyncStatus|=4:this.#r.zoneSyncStatus|=2)}).on("RaidBossKillNotify",i=>{this.#s.setKillState(1),this.#s.onPhaseTransition(1,i.time)}).on("RaidResult",i=>{i.parsed?.raidResult===1&&this.#s.setKillState(1),this.#s.onPhaseTransition(0,i.time)}).on("RemoveObject",i=>{let a=i.parsed;if(a)for(let m of a.unpublishedObjects)this.#n.RemoveLocalObject(m.objectId,i.time)}).on("SkillCastNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.getSourceEntity(a.caster);m=this.#t.guessIsPlayer(m,a.skillId),this.#s.onStartSkill(m,a.skillId,i.time)}).on("SkillDamageAbnormalMoveNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.getSourceEntity(a.sourceId);a.skillDamageAbnormalMoveEvents.forEach(f=>{let l=this.#t.getOrCreateEntity(f.skillDamageEvent.targetId),k=this.#t.getOrCreateEntity(a.sourceId);l.stats.set(1,f.skillDamageEvent.curHp),l.stats.set(27,f.skillDamageEvent.maxHp),this.#s.onDamage(m,k,l,{skillId:a.skillId,skillEffectId:a.skillEffectId,damage:Number(f.skillDamageEvent.damage),modifier:f.skillDamageEvent.modifier,targetCurHp:Number(f.skillDamageEvent.curHp),targetMaxHp:Number(f.skillDamageEvent.maxHp),damageAttr:f.skillDamageEvent.damageAttr??0,damageType:f.skillDamageEvent.damageType},a.skillDamageAbnormalMoveEvents.length,i.time)})}).on("SkillDamageNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.getSourceEntity(a.sourceId);a.skillDamageEvents.forEach(f=>{let l=this.#t.getOrCreateEntity(f.targetId),k=this.#t.getOrCreateEntity(a.sourceId);this.#s.onDamage(m,k,l,{skillId:a.skillId,skillEffectId:a.skillEffectId??0,damage:Number(f.damage),modifier:f.modifier,targetCurHp:Number(f.curHp),targetMaxHp:Number(f.maxHp),damageAttr:f.damageAttr??0,damageType:f.damageType},a.skillDamageEvents.length,i.time)})}).on("SkillStageNotify",i=>{}).on("SkillStartNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.getSourceEntity(a.sourceId);if(m=this.#t.guessIsPlayer(m,a.skillId),m.entityType===1){let f=m,l=f.skills.get(a.skillId);if(l||(l={effects:new Set,tripods:new Map},f.skills.set(a.skillId,l)),l.level=a.skillLevel,a.skillOptionData.tripodIndex&&a.skillOptionData.tripodLevel){l.tripods||(l.tripods=new Map);for(let[k,h]of["first","second","third"].entries()){if(a.skillOptionData.tripodIndex[h]===0){for(let j=1;j<=3;j++)l.tripods.delete(3*k+j);continue}let v=3*k+a.skillOptionData.tripodIndex[h],G=a.skillOptionData.tripodLevel[h],w=l.tripods.get(v);if(w&&G===w.level)continue;for(let j=1;j<=3;j++)l.tripods.delete(3*k+j);let B=this.#o.skillFeature.get(a.skillId)?.get(v),Q=[];B&&B.entries.forEach(j=>{j.level!==0&&j.level!==G||Q.push(j)}),l.tripods.set(v,{level:a.skillOptionData.tripodLevel[h],options:Q.sort((j,Kt)=>Kt.level-j.level)})}}}this.#s.onStartSkill(m,a.skillId,i.time)}).on("StatusEffectAddNotify",i=>{let a=i.parsed;if(!a)return;let m=this.#t.getSourceEntity(a.statusEffectData.sourceId);this.#n.RegisterStatusEffect(this.#n.buildStatusEffect(a.statusEffectData,a.objectId,m.entityId,1,i.time))}).on("StatusEffectDurationNotify",i=>{let a=i.parsed;a&&this.#n.UpdateDuration(a.effectInstanceId,a.targetId,a.expirationTick,1)}).on("StatusEffectRemoveNotify",i=>{let a=i.parsed;if(a)for(let m of a.statusEffectIds){let f=this.#n.RemoveStatusEffect(a.objectId,m,1,a.reason,i.time);f&&f.statusEffectId===9701&&this.#r.syncData()}}).on("StatusEffectSyncDataNotify",i=>{let a=i.parsed;a&&this.#n.SyncStatusEffect(a.effectInstanceId,a.characterId,a.objectId,a.value,this.#t.localPlayer.characterId)}).on("TriggerBossBattleStatus",i=>{this.#s.onPhaseTransition(2,i.time)}).on("TriggerFinishNotify",i=>{}).on("TriggerStartNotify",i=>{let a=i.parsed;if(a)switch(a.triggerSignalType){case 57:case 59:case 61:case 63:case 74:case 76:this.#s.setKillState(1);break;case 58:case 60:case 62:case 64:case 75:case 77:this.#s.setKillState(0);break;case 27:case 10:case 11:this.#r.syncData()}}).on("TroopMemberUpdateMinNotify",i=>{}).on("ZoneObjectUnpublishNotify",i=>{let a=i.parsed;a&&this.#n.RemoveLocalObject(a.objectId,i.time)}).on("ZoneStatusEffectAddNotify",i=>{}).on("TroopMemberUpdateMinNotify",i=>{let a=i.parsed;if(a&&a.statusEffectDatas.length>0)for(let m of a.statusEffectDatas){let f=this.#i.getEntityId(a.characterId),l=m.value?m.value.readUInt32LE():0,k=m.value?m.value.readUInt32LE(8):0,h=l<k?l:k;this.#n.SyncStatusEffect(m.effectInstanceId,a.characterId,f,h,this.#t.localPlayer.characterId)}}).on("ZoneStatusEffectRemoveNotify",i=>{}),this.#n.on("shieldApplied",i=>{let a=i.targetId;if(i.type===0&&(a=this.#i.getEntityId(i.targetId)??a),a===void 0)return;let m=this.#t.getSourceEntity(i.sourceId),f=this.#t.getOrCreateEntity(a);this.#s.onShieldApplied(f,m,i.statusEffectId,i.value)}).on("shieldChanged",(i,a,m)=>{let f=i.targetId;if(i.type===0&&(f=this.#i.getEntityId(i.targetId)??f),f===void 0)return;let l=this.#t.getSourceEntity(i.sourceId),k=this.#t.getOrCreateEntity(f);this.#s.onShieldUsed(k,l,i.statusEffectId,a-m)})}broadcastStateChange(){this.emit("state-change",this.#s.getBroadcast())}reset(){this.#s.resetState(+new Date)}cancelReset(){this.#s.cancelReset()}updateOptions(e){this.#s.updateOptions(e)}onConnect(e){this.#r.ip||(this.#r.ip=e.split(":")[0],Hu(this.#e,this.#s.options.isLive)&&this.#e.appendLog(new oe({account_CharacterId1:0n,serverAddr:e,account_CharacterId2:0n},11,we)))}get encounters(){return this.#s.splitEncounter(new Date),this.#s.encounters}};function Hu(t,e){return t instanceof sn||t.appendLog&&e}0&&(module.exports={Parser});
